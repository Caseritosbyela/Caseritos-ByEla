

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caseritos by Ela - Postres</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Montserrat:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;500;600;700&family=Lato:wght@300;400;700&family=Nunito:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=Dancing+Script:wght@400;500;600;700&family=Pacifico&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%); }
        .card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .cart-item { animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Store Status Banner -->
    <div id="store-status" class="bg-green-600 text-white text-center py-2 text-sm font-medium">
        üü¢ Tienda Abierta - Recibiendo pedidos
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50" style="top: 32px;">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo solamente -->
                <div class="flex items-center">
                    <div id="nav-logo-container">
                        <span id="nav-logo-emoji" class="text-2xl">üè†</span>
                        <img id="nav-logo-image" src="" alt="Logo" class="w-8 h-8 object-contain hidden">
                    </div>
                </div>

                <!-- Navegaci√≥n Central -->
                <div class="hidden lg:flex items-center space-x-6">
                    <a href="#inicio" class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Inicio</a>
                    <a href="#mas-vendidos" class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">M√°s Vendidos</a>
                    <a href="#nuevos" class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Nuevos</a>
                    <a href="#cuchareables" class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Cuchareables</a>
                    <a href="#solo-para-mi" class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Tentaciones</a>
                    <a href="#cajas" class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Cajas</a>
                    <a href="#cumpleanos" class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Cumplea√±os</a>
                    <a href="#contacto" class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Contacto</a>
                </div>

                <!-- Botones de Acci√≥n -->
                <div class="hidden md:flex items-center space-x-4">
                    <button onclick="toggleCart()" id="cart-btn-desktop" class="text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors relative" style="background-color: #ec4899;">
                        üõí Carrito (<span id="cart-count">0</span>)
                    </button>
                    <button onclick="showAdminLogin()" id="admin-btn-desktop" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                        ‚öôÔ∏è Admin
                    </button>
                </div>

                <!-- Men√∫ m√≥vil -->
                <div class="md:hidden flex items-center">
                    <button onclick="toggleCart()" class="text-gray-700 hover:text-pink-600 mr-4">
                        üõí <span id="cart-count-mobile">0</span>
                    </button>
                    <button id="mobile-menu-btn" class="text-gray-700 hover:text-pink-600">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile menu -->
        <div id="mobile-menu" class="md:hidden hidden bg-white border-t">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="#inicio" class="block px-3 py-2 text-gray-700 hover:text-pink-600">Inicio</a>
                <a href="#mas-vendidos" class="block px-3 py-2 text-gray-700 hover:text-pink-600" id="mobile-nav-mas-vendidos">M√°s Vendidos</a>
                <a href="#nuevos" class="block px-3 py-2 text-gray-700 hover:text-pink-600" id="mobile-nav-nuevos">Nuevos</a>
                <a href="#cuchareables" class="block px-3 py-2 text-gray-700 hover:text-pink-600" id="mobile-nav-cuchareables">Cuchareables</a>
                <a href="#solo-para-mi" class="block px-3 py-2 text-gray-700 hover:text-pink-600" id="mobile-nav-solo-para-mi">Tentaciones</a>
                <a href="#cajas" class="block px-3 py-2 text-gray-700 hover:text-pink-600" id="mobile-nav-cajas">Cajas</a>
                <a href="#cumpleanos" class="block px-3 py-2 text-gray-700 hover:text-pink-600" id="mobile-nav-cumpleanos">Cumplea√±os</a>
                <a href="#otros" class="block px-3 py-2 text-gray-700 hover:text-pink-600" id="mobile-nav-otros">Otros</a>
                <a href="#contacto" class="block px-3 py-2 text-gray-700 hover:text-pink-600">Contacto</a>
                <button onclick="showAdminLogin()" id="admin-btn-mobile" class="block w-full text-left px-3 py-2 text-gray-700 hover:text-pink-600">‚öôÔ∏è Admin</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="inicio" class="gradient-bg pt-24 pb-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-20">
            <div class="text-center">
                <div class="flex flex-col items-center mb-6">
                    <div id="hero-logo-container" class="mb-4">
                        <span id="hero-logo-emoji" class="text-8xl md:text-9xl">üè†</span>
                        <img id="hero-logo-image" src="" alt="Logo" class="w-32 h-32 md:w-40 md:h-40 object-contain hidden">
                    </div>
                    <h1 id="store-name-hero" class="text-4xl md:text-6xl font-bold text-white text-center">
                        Caseritos by Ela
                    </h1>
                </div>

                <div class="space-x-4">
                    <a href="#mas-vendidos" class="bg-white text-pink-600 hover:bg-gray-100 px-8 py-3 rounded-lg font-semibold transition-colors inline-block">
                        Ver Productos
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- M√°s Vendidos Section -->
    <section id="mas-vendidos" class="py-16 md:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 md:mb-20">
                <h2 id="mas-vendidos-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">üî• Los M√°s Vendidos</h2>
                <p id="mas-vendidos-description" class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
                    Nuestros productos favoritos de los clientes
                </p>
            </div>
            <div id="mas-vendidos-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
                <!-- Products will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Spacer -->
    <div class="h-8 md:h-12"></div>

    <!-- Nuevos Productos Section -->
    <section id="nuevos" class="py-16 md:py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 md:mb-20">
                <h2 id="nuevos-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">‚ú® Nuevos Productos</h2>
                <p id="nuevos-description" class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
                    Las √∫ltimas creaciones de nuestra reposter√≠a
                </p>
            </div>
            <div id="nuevos-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
                <!-- Products will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Spacer -->
    <div class="h-8 md:h-12"></div>

    <!-- Cuchareables Section -->
    <section id="cuchareables" class="py-16 md:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 md:mb-20">
                <h2 id="cuchareables-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">ü•Ñ Cuchareables</h2>
                <p id="cuchareables-description" class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
                    Deliciosos postres para disfrutar con cuchara
                </p>
            </div>
            <div id="cuchareables-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
                <!-- Products will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Spacer -->
    <div class="h-8 md:h-12"></div>

    <!-- Solo para M√≠ Section -->
    <section id="solo-para-mi" class="py-16 md:py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 md:mb-20">
                <h2 id="solo-para-mi-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">üç´ Tentaciones</h2>
                <p id="solo-para-mi-description" class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
                    Brownies artesanales en diferentes sabores para consentirte
                </p>
            </div>
            <div id="solo-para-mi-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
                <!-- Products will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Spacer -->
    <div class="h-8 md:h-12"></div>

    <!-- Cajas para Compartir Section -->
    <section id="cajas" class="py-16 md:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 md:mb-20">
                <h2 id="cajas-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">üì¶ Cajas para Compartir</h2>
                <p id="cajas-description" class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
                    Perfectas para reuniones familiares y celebraciones
                </p>
            </div>
            <div id="cajas-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
                <!-- Products will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Spacer -->
    <div class="h-8 md:h-12"></div>

    <!-- Cumplea√±os Section -->
    <section id="cumpleanos" class="py-16 md:py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 md:mb-20">
                <h2 id="cumpleanos-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">üéÇ Tortas de Cumplea√±os</h2>
                <p id="cumpleanos-description" class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
                    Tortas personalizadas para hacer tu celebraci√≥n inolvidable
                </p>
            </div>
            <div id="cumpleanos-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
                <!-- Products will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Spacer -->
    <div class="h-8 md:h-12"></div>

    <!-- Otros Productos Section -->
    <section id="otros" class="py-16 md:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 md:mb-20">
                <h2 id="otros-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">üç∞ Otros Productos</h2>
                <p id="otros-description" class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
                    Variedad de productos especiales
                </p>
            </div>
            <div id="otros-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
                <!-- Products will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contacto" class="py-16 md:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 md:mb-20">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">üìû Cont√°ctanos</h2>
                <p class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
                    ¬øTienes alguna pregunta? Estamos aqu√≠ para ayudarte
                </p>
            </div>
            
            <!-- Quick Contact Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center mb-12 md:mb-16">
                <a href="https://wa.me/50761336689?text=¬°Hola! Me interesa conocer m√°s sobre sus productos de reposter√≠a. ¬øPodr√≠an ayudarme?" 
                   target="_blank" 
                   class="bg-green-500 hover:bg-green-600 text-white font-semibold py-4 px-8 rounded-lg transition-colors flex items-center justify-center space-x-3 shadow-lg">
                    <span class="text-2xl">üí¨</span>
                    <span>WhatsApp: 6133-6689</span>
                </a>
                <a href="https://instagram.com/caseritosbyela" 
                   target="_blank" 
                   class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-semibold py-4 px-8 rounded-lg transition-colors flex items-center justify-center space-x-3 shadow-lg">
                    <span class="text-2xl">üì∏</span>
                    <span>@caseritosbyela</span>
                </a>
                <a href="https://tiktok.com/@caseritosbyela" 
                   target="_blank" 
                   class="bg-black hover:bg-gray-800 text-white font-semibold py-4 px-8 rounded-lg transition-colors flex items-center justify-center space-x-3 shadow-lg">
                    <span class="text-2xl">üéµ</span>
                    <span>@caseritosbyela</span>
                </a>
            </div>
            
            <div class="grid md:grid-cols-2 gap-12">
                <div class="space-y-8">
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center mr-4">
                            <span class="text-2xl">üìç</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Direcci√≥n</h3>
                            <p class="text-gray-600">Arraij√°n, Panam√° Oeste</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                            <span class="text-2xl">üì±</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Tel√©fono</h3>
                            <p class="text-gray-600">+507 6133-6689</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                            <span class="text-2xl">üìß</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Email</h3>
                            <p class="text-gray-600">caseritosbyela@gmail.com</p>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 p-8 rounded-xl">
                    <h3 class="text-xl font-semibold mb-6">‚≠ê Rese√±as de Clientes</h3>
                    <div class="space-y-6">
                        <!-- Customer Reviews -->
                        <div class="bg-white p-4 rounded-lg border-l-4 border-pink-500">
                            <div class="flex items-center mb-2">
                                <div class="text-yellow-400 text-lg">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                                <span class="ml-2 font-semibold text-gray-800">Mar√≠a Gonz√°lez</span>
                            </div>
                            <p class="text-gray-600 text-sm">"Compr√© una cajita de cuchareables y la am√©! Se ve√≠a muy linda y cada postre estaba delicioso. Perfecta para compartir."</p>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg border-l-4 border-pink-500">
                            <div class="flex items-center mb-2">
                                <div class="text-yellow-400 text-lg">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                                <span class="ml-2 font-semibold text-gray-800">Carlos Rodr√≠guez</span>
                            </div>
                            <p class="text-gray-600 text-sm">"La carlota de lim√≥n sin duda es mi favorita! Est√° incre√≠ble, el sabor perfecto y la presentaci√≥n hermosa."</p>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg border-l-4 border-pink-500">
                            <div class="flex items-center mb-2">
                                <div class="text-yellow-400 text-lg">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                                <span class="ml-2 font-semibold text-gray-800">Ana Mart√≠nez</span>
                            </div>
                            <p class="text-gray-600 text-sm">"Los brownies Choco Boom est√°n espectaculares! Ped√≠ varios sabores y todos quedaron perfectos. Muy recomendado."</p>
                        </div>
                        
                        <!-- Add Review Form -->
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">Deja tu rese√±a</h4>
                            <form class="space-y-3" onsubmit="submitReview(event)">
                                <input type="text" id="review-name" placeholder="Tu nombre" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm">
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm text-gray-600">Calificaci√≥n:</span>
                                    <div class="flex space-x-1" id="star-rating">
                                        <button type="button" onclick="setRating(1)" class="star text-gray-300 hover:text-yellow-400 text-lg">‚≠ê</button>
                                        <button type="button" onclick="setRating(2)" class="star text-gray-300 hover:text-yellow-400 text-lg">‚≠ê</button>
                                        <button type="button" onclick="setRating(3)" class="star text-gray-300 hover:text-yellow-400 text-lg">‚≠ê</button>
                                        <button type="button" onclick="setRating(4)" class="star text-gray-300 hover:text-yellow-400 text-lg">‚≠ê</button>
                                        <button type="button" onclick="setRating(5)" class="star text-gray-300 hover:text-yellow-400 text-lg">‚≠ê</button>
                                    </div>
                                </div>
                                <textarea id="review-text" rows="3" placeholder="Cu√©ntanos tu experiencia..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm"></textarea>
                                <button type="submit" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                    Enviar Rese√±a
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center mb-4">
                        <div id="footer-logo-container" class="mr-3">
                            <span id="footer-logo-emoji" class="text-3xl">üè†</span>
                            <img id="footer-logo-image" src="" alt="Logo" class="w-10 h-10 object-contain hidden">
                        </div>
                        <h3 id="store-name-footer" class="text-2xl font-bold">Caseritos by Ela</h3>
                    </div>
                    <p id="store-description-footer" class="text-gray-400 mb-6">
                        Reposter√≠a artesanal hecha con amor para endulzar tus momentos especiales.
                    </p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Productos</h4>
                    <ul class="space-y-2">
                        <li><a href="#cumpleanos" class="text-gray-400 hover:text-white transition-colors">Tortas de Cumplea√±os</a></li>
                        <li><a href="#cuchareables" class="text-gray-400 hover:text-white transition-colors">Cuchareables</a></li>
                        <li><a href="#cajas" class="text-gray-400 hover:text-white transition-colors">Cajas para Compartir</a></li>
                        <li><a href="#solo-para-mi" class="text-gray-400 hover:text-white transition-colors">Tentaciones</a></li>
                        <li><a href="#otros" class="text-gray-400 hover:text-white transition-colors">Otros Productos</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Horarios</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li>Lunes - Viernes: 8:00 AM - 7:00 PM</li>
                        <li>S√°bados: 9:00 AM - 6:00 PM</li>
                        <li>Domingos: 10:00 AM - 4:00 PM</li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center">
                <p class="text-gray-400">&copy; 2024 Caseritos by Ela. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Product Modal -->
    <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="modal-title" class="text-2xl font-bold text-gray-900"></h2>
                    <button onclick="closeProductModal()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <!-- Gift Options -->
                    <div id="gift-options" class="border rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4">¬øEs para regalo?</h3>
                        <div id="gift-options-list" class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="gift-bow" class="mr-3" onchange="updatePrice()">
                                <span>Lazo decorativo (+$2.00)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="gift-card" class="mr-3" onchange="updatePrice()">
                                <span>Tarjeta personalizada (+$1.50)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="gift-both" class="mr-3" onchange="updatePrice()">
                                <span>Lazo + Tarjeta (+$3.00)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Additional Options -->
                    <div id="additional-options" class="border rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4">Opciones adicionales</h3>
                        <div id="additional-options-list" class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="extra-decoration" class="mr-3" onchange="updatePrice()">
                                <span>Decoraci√≥n extra (+$5.00)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="premium-packaging" class="mr-3" onchange="updatePrice()">
                                <span>Empaque premium (+$3.50)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="express-delivery" class="mr-3" onchange="updatePrice()">
                                <span>Entrega express (+$8.00)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Customization Toggle -->
                    <div id="customization-toggle" class="border rounded-lg p-4" style="display: none;">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">üé® Personalizaci√≥n</h3>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="enable-customization" class="sr-only peer" onchange="toggleCustomization()">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-600"></div>
                            </label>
                        </div>
                        <p class="text-sm text-gray-600">Activa para personalizar tu caja con diferentes sabores</p>
                    </div>

                    <!-- Box Customization -->
                    <div id="box-customization" class="border rounded-lg p-4" style="display: none;">
                        <!-- Cuchareables Box -->
                        <div id="cuchareables-customization" class="hidden">
                            <h3 class="text-lg font-semibold mb-4">ü•Ñ Personaliza tu Caja de Cuchareables</h3>
                            <div id="box-selection-info" class="mb-4 p-3 bg-blue-50 rounded-lg">
                                <p class="text-blue-800 text-sm">Selecciona los sabores de cuchareables para tu caja. Puedes elegir diferentes cantidades de cada sabor.</p>
                            </div>
                            <div id="box-flavors-list" class="space-y-3">
                                <!-- Box flavors will be loaded dynamically -->
                            </div>
                        </div>

                        <!-- Brownies Box -->
                        <div id="brownies-customization" class="hidden">
                            <h3 class="text-lg font-semibold mb-4">üç´ Arma tu Caja de Brownies</h3>
                            <div id="brownies-selection-info" class="mb-4 p-3 bg-amber-50 rounded-lg">
                                <p class="text-amber-800 text-sm" id="brownies-instructions">Selecciona tus toppings favoritos para armar tu caja personalizada.</p>
                            </div>
                            
                            <!-- Creamy Toppings -->
                            <div class="mb-6">
                                <h4 class="font-semibold text-lg mb-3 text-amber-700">üçØ Creamy Toppings</h4>
                                <p class="text-sm text-gray-600 mb-3" id="creamy-limit">Selecciona m√°ximo 2 opciones</p>
                                <div id="creamy-toppings-list" class="grid grid-cols-1 gap-3">
                                    <!-- Creamy toppings will be loaded here -->
                                </div>
                            </div>

                            <!-- Regular Toppings -->
                            <div class="mb-4">
                                <h4 class="font-semibold text-lg mb-3 text-amber-700">üç´ Regular Toppings</h4>
                                <p class="text-sm text-gray-600 mb-3" id="regular-limit">Selecciona m√°ximo 4 opciones</p>
                                <div id="regular-toppings-list" class="grid grid-cols-1 gap-3">
                                    <!-- Regular toppings will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <div id="box-summary" class="mt-4 p-3 bg-gray-50 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="font-medium">Total seleccionado:</span>
                                <span id="box-total-count" class="font-bold text-pink-600">0 de 0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Special Instructions -->
                    <div class="border rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4">Instrucciones especiales</h3>
                        <textarea id="special-instructions" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="Mensaje para la tarjeta, colores espec√≠ficos, etc."></textarea>
                    </div>

                    <!-- Delivery Date -->
                    <div class="border rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4">üìÖ Fecha de Entrega</h3>
                        <input type="date" id="delivery-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" onchange="updateDeliveryMessage()">
                        <div id="delivery-message" class="mt-3 p-3 bg-blue-50 rounded-lg text-blue-800 text-sm hidden">
                            <span id="delivery-text"></span>
                        </div>
                        <div id="birthday-message" class="mt-3 p-3 bg-pink-50 rounded-lg text-pink-800 text-sm hidden">
                            üéÇ ¬°Perfecto para cumplea√±os! Cont√°ctanos por tel√©fono para coordinar el dise√±o personalizado.
                        </div>
                    </div>

                    <!-- Quantity -->
                    <div class="flex items-center justify-between">
                        <span class="text-lg font-semibold">Cantidad:</span>
                        <div class="flex items-center space-x-3">
                            <button onclick="changeQuantity(-1)" class="bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center">-</button>
                            <span id="quantity" class="text-xl font-semibold">1</span>
                            <button onclick="changeQuantity(1)" class="bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center">+</button>
                        </div>
                    </div>

                    <!-- Price -->
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center text-2xl font-bold">
                            <span>Total:</span>
                            <span id="modal-price" class="text-pink-600">$0.00</span>
                        </div>
                    </div>

                    <!-- Add to Cart Button -->
                    <button onclick="addToCart()" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                        Agregar al Carrito
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-4xl w-full max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">üõí Tu Carrito</h2>
                    <button onclick="toggleCart()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div id="cart-items" class="space-y-4 mb-6">
                    <!-- Cart items will be inserted here -->
                </div>

                <div class="border-t pt-6">
                    <!-- Coupon Section -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-4">üé´ Cup√≥n de Descuento</h3>
                        <div class="flex space-x-2">
                            <input type="text" id="coupon-code" placeholder="Ingresa tu c√≥digo" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent uppercase">
                            <button onclick="applyCoupon()" class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg transition-colors">
                                Aplicar
                            </button>
                        </div>
                        <div id="coupon-message" class="mt-3 p-3 rounded-lg text-sm hidden">
                            <span id="coupon-text"></span>
                        </div>
                    </div>

                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between items-center">
                            <span>Subtotal:</span>
                            <span id="cart-subtotal" class="text-gray-700">$0.00</span>
                        </div>
                        <div id="coupon-discount-line" class="flex justify-between items-center text-green-600 hidden">
                            <span>Descuento (<span id="applied-coupon-code"></span>):</span>
                            <span id="coupon-discount-amount">-$0.00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>Delivery:</span>
                            <span id="delivery-cost" class="text-gray-700">Gratis</span>
                        </div>
                        <div class="flex justify-between items-center text-2xl font-bold border-t pt-3">
                            <span>Total:</span>
                            <span id="cart-total" class="text-pink-600">$0.00</span>
                        </div>
                    </div>

                    <!-- Delivery Method -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-4">M√©todo de Entrega</h3>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="radio" name="delivery-method" value="pickup" class="mr-3" checked>
                                <span>üè™ Recoger en tienda (Gratis)</span>
                            </label>
                            <label class="flex items-center" id="delivery-option">
                                <input type="radio" name="delivery-method" value="delivery" class="mr-3" disabled>
                                <span id="delivery-option-text">üöö Delivery (Deshabilitado)</span>
                            </label>
                        </div>
                        <div id="delivery-zone-info" class="mt-2 text-sm text-gray-600 hidden">
                            üìç Zona de entrega: <span id="delivery-zone-display">Arraij√°n y alrededores</span>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-4">M√©todo de Pago</h3>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="radio" name="payment-method" value="yappy" class="mr-3" onchange="showPaymentInfo()">
                                <span>üí≥ Yappy</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="payment-method" value="transfer" class="mr-3" onchange="showPaymentInfo()">
                                <span>üè¶ Transferencia Bancaria</span>
                            </label>
                        </div>
                        <div id="payment-info" class="mt-4 p-4 bg-gray-50 rounded-lg hidden">
                            <div id="yappy-info" class="hidden">
                                <h4 class="font-semibold text-green-600 mb-2">üí≥ Informaci√≥n para Yappy:</h4>
                                <p class="text-sm text-gray-700" id="yappy-number">N√∫mero: +507 6123-4567</p>
                                <p class="text-sm text-gray-500">Env√≠a el pago y adjunta el comprobante</p>
                            </div>
                            <div id="transfer-info" class="hidden">
                                <h4 class="font-semibold text-blue-600 mb-2">üè¶ Informaci√≥n para Transferencia:</h4>
                                <p class="text-sm text-gray-700" id="bank-account">Cuenta: Banco General - 04-01-01-123456-7</p>
                                <p class="text-sm text-gray-500">Realiza la transferencia y adjunta el comprobante</p>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Proof Upload -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-4">Comprobante de Pago</h3>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <input type="file" id="payment-proof" accept="image/*" class="hidden" onchange="handleFileUpload(event)">
                            <button onclick="document.getElementById('payment-proof').click()" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-colors">
                                üìé Adjuntar Comprobante
                            </button>
                            <p class="text-gray-500 text-sm mt-2">Formatos: JPG, PNG, PDF</p>
                            <div id="file-preview" class="mt-4 hidden">
                                <p class="text-green-600">‚úÖ Archivo adjuntado correctamente</p>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Info -->
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <input type="text" id="customer-name" placeholder="Nombre completo" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                        <input type="tel" id="customer-phone" placeholder="Tel√©fono" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                        <input type="email" id="customer-email" placeholder="Email" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                        <input type="text" id="delivery-address" placeholder="Direcci√≥n de entrega" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                    </div>

                    <button onclick="processOrder()" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                        Confirmar Pedido
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="admin-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-6xl w-full max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">‚öôÔ∏è Panel de Administraci√≥n</h2>
                    <button onclick="toggleAdmin()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Admin Tabs -->
                <div class="mb-6">
                    <div class="border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8">
                            <button onclick="showAdminTab('store')" id="store-tab" class="admin-tab-active py-2 px-1 border-b-2 border-pink-500 font-medium text-sm text-pink-600">
                                üè™ Tienda
                            </button>
                            <button onclick="showAdminTab('products')" id="products-tab" class="admin-tab py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                üì¶ Productos
                            </button>
                            <button onclick="showAdminTab('orders')" id="orders-tab" class="admin-tab py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                üìã Pedidos
                            </button>
                            <button onclick="showAdminTab('categories')" id="categories-tab" class="admin-tab py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                üìÇ Categor√≠as
                            </button>
                            <button onclick="showAdminTab('extras')" id="extras-tab" class="admin-tab py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                ‚öôÔ∏è Extras
                            </button>
                            <button onclick="showAdminTab('reviews')" id="reviews-tab" class="admin-tab py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                ‚≠ê Rese√±as
                            </button>
                            <button onclick="showAdminTab('coupons')" id="coupons-tab" class="admin-tab py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                üé´ Cupones
                            </button>
                            <button onclick="showAdminTab('settings')" id="settings-tab" class="admin-tab py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                üé® Personalizaci√≥n
                            </button>
                        </nav>
                    </div>
                </div>

                <!-- Store Management Tab -->
                <div id="store-content" class="admin-content">
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Store Status Control -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">Estado de la Tienda</h3>
                            <div class="space-y-4">
                                <button onclick="toggleStoreStatus()" id="store-toggle-btn" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition-colors">
                                    üü¢ Cerrar Tienda
                                </button>
                                <p class="text-sm text-gray-600">Cuando la tienda est√© cerrada, los clientes no podr√°n realizar pedidos.</p>
                            </div>
                        </div>

                        <!-- Delivery Management -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">üöö Gesti√≥n de Delivery</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Habilitar Delivery</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="enable-delivery" class="sr-only peer" onchange="toggleDeliveryService()">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-600"></div>
                                    </label>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Costo de Delivery ($)</label>
                                    <input type="number" id="delivery-cost-input" value="5.00" step="0.50" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Zona de Delivery</label>
                                    <input type="text" id="delivery-zone" value="Arraij√°n y alrededores" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <button onclick="saveDeliverySettings()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors">
                                    üíæ Guardar Configuraci√≥n
                                </button>
                            </div>
                        </div>

                        <!-- Quick Stats -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">Estad√≠sticas R√°pidas</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-white p-3 rounded-lg text-center">
                                    <div class="text-xl font-bold text-blue-600" id="pending-orders">0</div>
                                    <div class="text-xs text-blue-800">Pendientes</div>
                                </div>
                                <div class="bg-white p-3 rounded-lg text-center">
                                    <div class="text-xl font-bold text-green-600" id="completed-orders">0</div>
                                    <div class="text-xs text-green-800">Completados</div>
                                </div>
                                <div class="bg-white p-3 rounded-lg text-center">
                                    <div class="text-xl font-bold text-yellow-600" id="total-revenue">$0.00</div>
                                    <div class="text-xs text-yellow-800">Ingresos</div>
                                </div>
                                <div class="bg-white p-3 rounded-lg text-center">
                                    <div class="text-xl font-bold text-purple-600" id="products-sold">0</div>
                                    <div class="text-xs text-purple-800">Vendidos</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Management Tab -->
                <div id="products-content" class="admin-content hidden">
                    <div class="mb-6">
                        <button onclick="showAddProductModal()" class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg transition-colors">
                            ‚ûï Agregar Producto
                        </button>
                    </div>
                    
                    <!-- Category Tabs -->
                    <div class="mb-6">
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-4 overflow-x-auto">
                                <button onclick="showCategoryProducts('mas-vendidos')" id="cat-mas-vendidos" class="category-tab-active whitespace-nowrap py-2 px-3 border-b-2 border-pink-500 font-medium text-sm text-pink-600">
                                    üî• M√°s Vendidos
                                </button>
                                <button onclick="showCategoryProducts('nuevos')" id="cat-nuevos" class="category-tab whitespace-nowrap py-2 px-3 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                                    ‚ú® Nuevos
                                </button>
                                <button onclick="showCategoryProducts('cuchareables')" id="cat-cuchareables" class="category-tab whitespace-nowrap py-2 px-3 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                                    ü•Ñ Cuchareables
                                </button>
                                <button onclick="showCategoryProducts('solo-para-mi')" id="cat-solo-para-mi" class="category-tab whitespace-nowrap py-2 px-3 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                                    üç´ Tentaciones
                                </button>
                                <button onclick="showCategoryProducts('cajas')" id="cat-cajas" class="category-tab whitespace-nowrap py-2 px-3 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                                    üì¶ Cajas
                                </button>
                                <button onclick="showCategoryProducts('cumpleanos')" id="cat-cumpleanos" class="category-tab whitespace-nowrap py-2 px-3 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                                    üéÇ Cumplea√±os
                                </button>
                                <button onclick="showCategoryProducts('otros')" id="cat-otros" class="category-tab whitespace-nowrap py-2 px-3 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                                    üç∞ Otros
                                </button>
                            </nav>
                        </div>
                    </div>

                    <!-- Products Grid -->
                    <div id="admin-products-grid" class="grid md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <!-- Products will be displayed here -->
                    </div>
                </div>

                <!-- Orders Management Tab -->
                <div id="orders-content" class="admin-content hidden">
                    <!-- Order Filters -->
                    <div class="mb-6 bg-gray-50 p-4 rounded-xl">
                        <div class="grid md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Filtrar por Estado</label>
                                <select id="order-status-filter" onchange="filterOrders()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                    <option value="all">Todos los Estados</option>
                                    <option value="pending">‚è≥ Pendientes</option>
                                    <option value="in-progress">üë®‚Äçüç≥ En Preparaci√≥n</option>
                                    <option value="ready">üì¶ Listos</option>
                                    <option value="completed">‚úÖ Entregados</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Filtrar por Pago</label>
                                <select id="payment-status-filter" onchange="filterOrders()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                    <option value="all">Todos los Pagos</option>
                                    <option value="pending">üí≥ Pendientes</option>
                                    <option value="verified">‚úÖ Verificados</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Buscar Cliente</label>
                                <input type="text" id="customer-search" placeholder="Nombre o tel√©fono..." onkeyup="filterOrders()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                            </div>
                            <div class="flex items-end">
                                <button onclick="clearOrderFilters()" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    üîÑ Limpiar Filtros
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Orders Summary -->
                    <div class="mb-6 grid md:grid-cols-5 gap-4">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-yellow-600" id="pending-count">0</div>
                            <div class="text-sm text-yellow-800">Pendientes</div>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-600" id="progress-count">0</div>
                            <div class="text-sm text-blue-800">En Preparaci√≥n</div>
                        </div>
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-orange-600" id="ready-count">0</div>
                            <div class="text-sm text-orange-800">Listos</div>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-600" id="completed-count">0</div>
                            <div class="text-sm text-green-800">Entregados</div>
                        </div>
                        <div class="bg-pink-50 border border-pink-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-pink-600" id="total-orders-count">0</div>
                            <div class="text-sm text-pink-800">Total</div>
                        </div>
                    </div>

                    <div id="orders-list" class="space-y-4">
                        <p class="text-gray-500 text-center py-8">No hay pedidos registrados a√∫n</p>
                    </div>
                </div>

                <!-- Categories Management Tab -->
                <div id="categories-content" class="admin-content hidden">
                    <div class="space-y-6">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-yellow-800 mb-2">üìù Editar Categor√≠as</h3>
                            <p class="text-yellow-700 text-sm">Personaliza los nombres y descripciones de las categor√≠as de productos. Los cambios se aplicar√°n inmediatamente en toda la tienda.</p>
                        </div>
                        
                        <div id="categories-list" class="grid md:grid-cols-2 gap-6">
                            <!-- Categories will be loaded here -->
                        </div>
                        
                        <div class="flex justify-center">
                            <button onclick="saveCategoryChanges()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                                üíæ Guardar Todos los Cambios
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Extras Management Tab -->
                <div id="extras-content" class="admin-content hidden">
                    <div class="space-y-8">
                        <!-- Brownie Toppings Management -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">üç´ Gesti√≥n de Toppings de Brownies</h3>
                            
                            <!-- Creamy Toppings -->
                            <div class="mb-6">
                                <h4 class="font-semibold text-lg mb-3 text-amber-700">üçØ Creamy Toppings</h4>
                                <div id="admin-creamy-toppings" class="space-y-3">
                                    <!-- Creamy toppings will be loaded here -->
                                </div>
                            </div>

                            <!-- Regular Toppings -->
                            <div class="mb-6">
                                <h4 class="font-semibold text-lg mb-3 text-amber-700">üç´ Regular Toppings</h4>
                                <div id="admin-regular-toppings" class="space-y-3">
                                    <!-- Regular toppings will be loaded here -->
                                </div>
                            </div>

                            <button onclick="saveToppingsAvailability()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                                üíæ Guardar Disponibilidad
                            </button>
                        </div>

                        <!-- Delivery Date Management -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">üìÖ Gesti√≥n de Fechas de Entrega</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pr√≥xima Fecha de Entrega</label>
                                    <input type="date" id="admin-next-delivery" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">D√≠as entre entregas</label>
                                    <input type="number" id="delivery-interval" value="15" min="1" max="30" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                            </div>
                            <button onclick="updateDeliverySchedule()" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                                üìÖ Actualizar Fechas
                            </button>
                        </div>

                        <!-- Gift Options Management -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">üéÅ Opciones de Regalo</h3>
                            <div id="gift-options-editor" class="space-y-4">
                                <!-- Gift options will be loaded here -->
                            </div>
                            <button onclick="addGiftOption()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                ‚ûï Agregar Opci√≥n de Regalo
                            </button>
                        </div>

                        <!-- Additional Options Management -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">‚öôÔ∏è Opciones Adicionales</h3>
                            <div id="additional-options-editor" class="space-y-4">
                                <!-- Additional options will be loaded here -->
                            </div>
                            <button onclick="addAdditionalOption()" class="mt-4 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                                ‚ûï Agregar Opci√≥n Adicional
                            </button>
                        </div>

                        <div class="flex justify-center">
                            <button onclick="saveExtrasChanges()" class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                                üíæ Guardar Todos los Cambios
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reviews Management Tab -->
                <div id="reviews-content" class="admin-content hidden">
                    <div class="space-y-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-blue-800 mb-2">‚≠ê Gesti√≥n de Rese√±as</h3>
                            <p class="text-blue-700 text-sm">Aqu√≠ podr√°s ver, responder y gestionar todas las rese√±as de clientes. Las funciones de respuesta y eliminaci√≥n estar√°n disponibles pr√≥ximamente.</p>
                        </div>
                        
                        <div class="bg-white border rounded-lg p-6">
                            <h4 class="font-semibold mb-4">Rese√±as Recientes</h4>
                            <div class="space-y-4">
                                <div class="border-l-4 border-yellow-400 pl-4 py-2">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-yellow-400">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                            <span class="font-medium">Mar√≠a Gonz√°lez</span>
                                        </div>
                                        <span class="text-sm text-gray-500">Hace 2 d√≠as</span>
                                    </div>
                                    <p class="text-gray-700 text-sm">"Los brownies est√°n deliciosos! Ped√≠ una caja de 6 sabores diferentes y todos estaban perfectos. Muy recomendado."</p>
                                    <div class="mt-2 space-x-2">
                                        <button class="text-blue-600 hover:text-blue-800 text-sm">üí¨ Responder</button>
                                        <button class="text-red-600 hover:text-red-800 text-sm">üóëÔ∏è Eliminar</button>
                                    </div>
                                </div>
                                
                                <div class="border-l-4 border-yellow-400 pl-4 py-2">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-yellow-400">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                            <span class="font-medium">Carlos Rodr√≠guez</span>
                                        </div>
                                        <span class="text-sm text-gray-500">Hace 1 semana</span>
                                    </div>
                                    <p class="text-gray-700 text-sm">"Excelente servicio y productos de calidad. La torta de cumplea√±os qued√≥ hermosa y sab√≠a incre√≠ble."</p>
                                    <div class="mt-2 space-x-2">
                                        <button class="text-blue-600 hover:text-blue-800 text-sm">üí¨ Responder</button>
                                        <button class="text-red-600 hover:text-red-800 text-sm">üóëÔ∏è Eliminar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Coupons Management Tab -->
                <div id="coupons-content" class="admin-content hidden">
                    <div class="space-y-8">
                        <!-- Add New Coupon -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">‚ûï Crear Nuevo Cup√≥n</h3>
                            <form id="add-coupon-form" class="space-y-4">
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">C√≥digo del Cup√≥n</label>
                                        <input type="text" id="new-coupon-code" placeholder="Ej: DESCUENTO10" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent uppercase" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Descuento</label>
                                        <select id="new-coupon-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" required>
                                            <option value="percentage">Porcentaje (%)</option>
                                            <option value="fixed">Monto Fijo ($)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Valor del Descuento</label>
                                        <input type="number" id="new-coupon-value" min="0" step="0.01" placeholder="10" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Compra M√≠nima ($)</label>
                                        <input type="number" id="new-coupon-minimum" min="0" step="0.01" placeholder="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                    </div>
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Fecha de Expiraci√≥n</label>
                                        <input type="date" id="new-coupon-expiry" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">L√≠mite de Usos</label>
                                        <input type="number" id="new-coupon-limit" min="1" placeholder="Sin l√≠mite" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
                                    <input type="text" id="new-coupon-description" placeholder="Ej: Descuento del 10% en tu primera compra" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                
                                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition-colors">
                                    üé´ Crear Cup√≥n
                                </button>
                            </form>
                        </div>

                        <!-- Active Coupons -->
                        <div class="bg-white border rounded-lg p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">üé´ Cupones Activos</h3>
                                <div class="text-sm text-gray-500">
                                    Total: <span id="active-coupons-count">0</span> cupones
                                </div>
                            </div>
                            <div id="active-coupons-list" class="space-y-4">
                                <p class="text-gray-500 text-center py-8">No hay cupones activos</p>
                            </div>
                        </div>

                        <!-- Expired/Disabled Coupons -->
                        <div class="bg-white border rounded-lg p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">üìã Historial de Cupones</h3>
                                <div class="text-sm text-gray-500">
                                    Total: <span id="inactive-coupons-count">0</span> cupones
                                </div>
                            </div>
                            <div id="inactive-coupons-list" class="space-y-4">
                                <p class="text-gray-500 text-center py-8">No hay cupones inactivos</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Store Settings Tab -->
                <div id="settings-content" class="admin-content hidden">
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Store Branding -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">üè™ Informaci√≥n de la Tienda</h3>
                            <form id="store-settings-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nombre de la Tienda</label>
                                    <input type="text" id="store-name-input" value="Caserito by Ela" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Logo de la Marca</label>
                                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                                        <input type="file" id="brand-logo" accept="image/*" class="hidden" onchange="handleBrandLogoUpload(event)">
                                        <button type="button" onclick="document.getElementById('brand-logo').click()" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-colors">
                                            üñºÔ∏è Subir Logo
                                        </button>
                                        <p class="text-gray-500 text-sm mt-2">JPG, PNG (m√°x. 2MB)</p>
                                        <div id="brand-logo-preview" class="mt-3 hidden">
                                            <img id="brand-preview-img" src="" alt="Logo" class="w-20 h-20 object-contain rounded-lg mx-auto border">
                                            <button type="button" onclick="removeBrandLogo()" class="text-red-500 text-sm mt-2 hover:text-red-700">Eliminar Logo</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Banner de Portada</label>
                                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                                        <input type="file" id="hero-banner" accept="image/*" class="hidden" onchange="handleHeroBannerUpload(event)">
                                        <button type="button" onclick="document.getElementById('hero-banner').click()" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-colors">
                                            üñºÔ∏è Subir Banner
                                        </button>
                                        <p class="text-gray-500 text-sm mt-2">JPG, PNG (m√°x. 5MB) - Recomendado: 1920x600px</p>
                                        <div id="hero-banner-preview" class="mt-3 hidden">
                                            <img id="banner-preview-img" src="" alt="Banner" class="w-full h-32 object-cover rounded-lg border">
                                            <div class="mt-3 space-y-2">
                                                <label class="block text-sm font-medium text-gray-700">Altura del Banner:</label>
                                                <input type="range" id="banner-height-slider" min="300" max="800" value="500" class="w-full" onchange="updateBannerHeight()">
                                                <div class="flex justify-between text-xs text-gray-500">
                                                    <span>Peque√±o (300px)</span>
                                                    <span id="banner-height-display">500px</span>
                                                    <span>Grande (800px)</span>
                                                </div>
                                            </div>
                                            <button type="button" onclick="removeHeroBanner()" class="text-red-500 text-sm mt-2 hover:text-red-700">Eliminar Banner</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Emoji Alternativo (si no hay logo)</label>
                                    <input type="text" id="store-logo-input" value="üè†" maxlength="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
                                    <textarea id="store-description-input" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">Reposter√≠a artesanal hecha con amor</textarea>
                                </div>
                                
                                <button type="submit" class="w-full text-white py-3 px-4 rounded-lg transition-colors" style="background-color: #ec4899;">
                                    üíæ Guardar Cambios
                                </button>
                            </form>
                        </div>

                        <!-- Color Customization -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">üé® Colores de la Tienda</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Color Principal</label>
                                    <div class="flex items-center space-x-3">
                                        <input type="color" id="primary-color-input" value="#ec4899" class="w-12 h-10 border border-gray-300 rounded cursor-pointer">
                                        <input type="text" id="primary-color-text" value="#ec4899" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Color Secundario (Gradiente)</label>
                                    <div class="flex items-center space-x-3">
                                        <input type="color" id="secondary-color-input" value="#feca57" class="w-12 h-10 border border-gray-300 rounded cursor-pointer">
                                        <input type="text" id="secondary-color-text" value="#feca57" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Vista Previa</label>
                                    <div id="color-preview" class="w-full h-20 rounded-lg" style="background: linear-gradient(135deg, #ec4899 0%, #feca57 100%);"></div>
                                </div>
                                
                                <button onclick="applyColors()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors">
                                    üé® Aplicar Colores
                                </button>
                            </div>
                        </div>

                        <!-- Typography Settings -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">üî§ Tipograf√≠a</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Fuente Principal (T√≠tulos y Navegaci√≥n)</label>
                                    <select id="font-family-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                        <option value="Inter">Inter (Moderna)</option>
                                        <option value="Poppins">Poppins (Amigable)</option>
                                        <option value="Roboto">Roboto (Cl√°sica)</option>
                                        <option value="Montserrat">Montserrat (Elegante)</option>
                                        <option value="Open Sans">Open Sans (Legible)</option>
                                        <option value="Lato">Lato (Profesional)</option>
                                        <option value="Nunito">Nunito (Redondeada)</option>
                                        <option value="Playfair Display">Playfair Display (Elegante)</option>
                                        <option value="Dancing Script">Dancing Script (Manuscrita)</option>
                                        <option value="Pacifico">Pacifico (Divertida)</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Fuente Secundaria (Textos y P√°rrafos)</label>
                                    <select id="secondary-font-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                        <option value="Inter">Inter (Moderna)</option>
                                        <option value="Poppins">Poppins (Amigable)</option>
                                        <option value="Roboto">Roboto (Cl√°sica)</option>
                                        <option value="Montserrat">Montserrat (Elegante)</option>
                                        <option value="Open Sans">Open Sans (Legible)</option>
                                        <option value="Lato">Lato (Profesional)</option>
                                        <option value="Nunito">Nunito (Redondeada)</option>
                                        <option value="Playfair Display">Playfair Display (Elegante)</option>
                                        <option value="Dancing Script">Dancing Script (Manuscrita)</option>
                                        <option value="Pacifico">Pacifico (Divertida)</option>
                                    </select>
                                </div>
                                
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Vista Previa</label>
                                    <div id="font-preview" class="p-4 border rounded-lg bg-white">
                                        <h4 id="primary-font-preview" class="text-xl font-bold mb-2">Caserito by Ela</h4>
                                        <p id="secondary-font-preview" class="text-gray-600">Reposter√≠a artesanal hecha con amor para endulzar tus momentos especiales.</p>
                                    </div>
                                </div>
                                
                                <button onclick="applyFont()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg transition-colors">
                                    üî§ Aplicar Tipograf√≠a
                                </button>
                            </div>
                        </div>

                        <!-- Security Settings -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">üîê Configuraci√≥n de Seguridad</h3>
                            <form id="security-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nueva Contrase√±a de Admin</label>
                                    <input type="password" id="new-admin-password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="Dejar vac√≠o para mantener actual">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Nueva Contrase√±a</label>
                                    <input type="password" id="confirm-admin-password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="Confirmar contrase√±a">
                                </div>
                                
                                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition-colors">
                                    üîí Cambiar Contrase√±a
                                </button>
                            </form>
                        </div>

                        <!-- Contact Information -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">üìû Informaci√≥n de Contacto</h3>
                            <form id="contact-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Direcci√≥n</label>
                                    <input type="text" id="contact-address" value="Calle Principal 123, Ciudad, Pa√≠s 12345" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tel√©fono</label>
                                    <input type="text" id="contact-phone" value="+507 6133-6689" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="contact-email" value="pedidos@dulcesydelicias.com" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Horarios de Atenci√≥n</label>
                                    <textarea id="contact-hours" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">Lunes - Viernes: 8:00 AM - 7:00 PM
S√°bados: 9:00 AM - 6:00 PM
Domingos: 10:00 AM - 4:00 PM</textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">N√∫mero Yappy</label>
                                    <input type="text" id="yappy-number-input" value="+507 6123-4567" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Cuenta Bancaria</label>
                                    <input type="text" id="bank-account-input" value="Banco General - 04-01-01-123456-7" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors">
                                    üìû Guardar Contacto
                                </button>
                            </form>
                        </div>

                        <!-- Admin Access Control -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">üë• Control de Acceso</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Mostrar bot√≥n Admin a clientes</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="show-admin-btn" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-600"></div>
                                    </label>
                                </div>
                                <p class="text-xs text-gray-500">Cuando est√© desactivado, solo el due√±o podr√° acceder al panel admin usando Ctrl+Shift+A</p>
                                
                                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                                    <p class="text-sm text-blue-800"><strong>Acceso r√°pido:</strong> Presiona <kbd class="bg-blue-200 px-2 py-1 rounded text-xs">Ctrl + Shift + A</kbd> para acceder al panel admin desde cualquier parte de la p√°gina.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">üîê Acceso de Administrador</h2>
                    <button onclick="closeAdminLogin()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="admin-login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contrase√±a de Administrador</label>
                        <input type="password" id="admin-password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="Ingresa tu contrase√±a" required>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button type="button" onclick="closeAdminLogin()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-4 rounded-lg transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="flex-1 text-white py-3 px-4 rounded-lg transition-colors" style="background-color: #ec4899;">
                            Ingresar
                        </button>
                    </div>
                </form>
                
                <div class="mt-4 text-center">
                    <p class="text-xs text-gray-500">¬øOlvidaste tu contrase√±a? Contacta al administrador del sistema.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Receipt Modal -->
    <div id="payment-receipt-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">üìÑ Comprobante de Pago</h2>
                    <button onclick="closePaymentReceiptModal()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div id="receipt-content" class="space-y-6">
                    <!-- Receipt content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="add-product-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">‚ûï Agregar Producto</h2>
                    <button onclick="closeAddProductModal()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="add-product-form" class="space-y-6">
                    <!-- Product Image -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Imagen del Producto</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <input type="file" id="product-image" accept="image/*" class="hidden" onchange="handleProductImageUpload(event)">
                            <button type="button" onclick="document.getElementById('product-image').click()" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-colors">
                                üì∑ Subir Imagen
                            </button>
                            <p class="text-gray-500 text-sm mt-2">JPG, PNG (m√°x. 5MB)</p>
                            <div id="product-image-preview" class="mt-4 hidden">
                                <img id="preview-img" src="" alt="Preview" class="w-32 h-32 object-cover rounded-lg mx-auto">
                            </div>
                        </div>
                    </div>

                    <!-- Product Details -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nombre del Producto</label>
                            <input type="text" id="product-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Precio ($)</label>
                            <input type="number" id="product-price" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
                        <textarea id="product-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="Descripci√≥n breve del producto"></textarea>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categor√≠a</label>
                            <select id="product-category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" required>
                                <option value="">Seleccionar categor√≠a</option>
                                <option value="mas-vendidos">üî• M√°s Vendidos</option>
                                <option value="nuevos">‚ú® Nuevos</option>
                                <option value="cuchareables">ü•Ñ Cuchareables</option>
                                <option value="solo-para-mi">üç´ Tentaciones</option>
                                <option value="cajas">üì¶ Cajas para Compartir</option>
                                <option value="cumpleanos">üéÇ Cumplea√±os</option>
                                <option value="otros">üç∞ Otros</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Estado del Inventario</label>
                            <select id="product-stock" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" required>
                                <option value="in-stock">‚úÖ En Stock</option>
                                <option value="low-stock">‚ö†Ô∏è Pocas unidades</option>
                                <option value="out-of-stock">‚ùå Agotado</option>
                            </select>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="product-customizable" class="mr-3">
                            <span class="text-sm font-medium text-gray-700">Producto personalizable (permite opciones de regalo y extras)</span>
                        </label>
                        
                        <div id="box-type-selection" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Caja (solo para cajas personalizables)</label>
                            <select id="product-box-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                <option value="">No es una caja</option>
                                <option value="brownies">Caja de Brownies</option>
                                <option value="cuchareables">Caja de Cuchareables</option>
                            </select>
                        </div>
                        
                        <div id="box-size-selection" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tama√±o de la Caja</label>
                            <input type="number" id="product-box-size" min="1" max="20" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="Ej: 4, 6, 12">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Emoji del Producto</label>
                        <input type="text" id="product-emoji" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="üßÅ" maxlength="2">
                        <p class="text-gray-500 text-sm mt-1">Emoji que se mostrar√° si no hay imagen</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descuento (%)</label>
                        <input type="number" id="product-discount" min="0" max="90" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="0">
                        <p class="text-gray-500 text-sm mt-1">Porcentaje de descuento (0 = sin descuento, m√°ximo 90%)</p>
                    </div>

                    <div class="flex space-x-4">
                        <button type="button" onclick="closeAddProductModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-4 rounded-lg transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="flex-1 bg-pink-600 hover:bg-pink-700 text-white py-3 px-4 rounded-lg transition-colors">
                            Agregar Producto
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let cart = [];
        let currentProduct = {};
        let orders = [];
        let storeOpen = true;
        let categories = {
            'mas-vendidos': { name: 'üî• M√°s Vendidos', description: 'Nuestros productos favoritos de los clientes' },
            'nuevos': { name: '‚ú® Nuevos Productos', description: 'Las √∫ltimas creaciones de nuestra reposter√≠a' },
            'cuchareables': { name: 'ü•Ñ Cuchareables', description: 'Deliciosos postres para disfrutar con cuchara' },
            'solo-para-mi': { name: 'üç´ Tentaciones', description: 'Brownies artesanales en diferentes sabores para consentirte' },
            'cajas': { name: 'üì¶ Cajas para Compartir', description: 'Perfectas para reuniones familiares y celebraciones' },
            'cumpleanos': { name: 'üéÇ Tortas de Cumplea√±os', description: 'Tortas personalizadas para hacer tu celebraci√≥n inolvidable' },
            'otros': { name: 'üç∞ Otros Productos', description: 'Variedad de productos especiales' }
        };
        
        let products = {
            'mas-vendidos': [],
            'nuevos': [],
            'cuchareables': [],
            'solo-para-mi': [],
            'cajas': [],
            'cumpleanos': [],
            'otros': []
        };
        let currentCategory = 'mas-vendidos';
        let isAdminAuthenticated = false;
        let storeSettings = {
            name: 'Caseritos by Ela',
            logo: 'üè†',
            brandImage: null,
            heroBanner: null,
            bannerHeight: 500,
            primaryColor: '#ec4899', // pink-600
            secondaryColor: '#feca57',
            description: 'Reposter√≠a artesanal hecha con amor',
            fontFamily: 'Inter',
            secondaryFontFamily: 'Inter'
        };
        
        let contactInfo = {
            address: 'Arraij√°n, Panam√° Oeste',
            phone: '+507 6133-6689',
            email: 'caseritosbyela@gmail.com',
            hours: 'Lunes - Viernes: 8:00 AM - 7:00 PM\nS√°bados: 9:00 AM - 6:00 PM\nDomingos: 10:00 AM - 4:00 PM',
            yappyNumber: '+507 6133-6689',
            bankAccount: 'Banco General - 04-01-01-123456-7'
        };

        // Delivery management
        let deliverySettings = {
            nextDeliveryDate: null,
            intervalDays: 15,
            enabled: false,
            cost: 5.00,
            zone: 'Arraij√°n y alrededores'
        };

        // Coupon system
        let coupons = [];
        let appliedCoupon = null;

        // Brownie toppings system
        let brownieToppings = {
            creamy: [
                { id: 'dulce-leche', name: 'Dulce de Leche', emoji: 'üçÆ', available: true },
                { id: 'mantequilla-mani', name: 'Mantequilla de Man√≠', emoji: 'ü•ú', available: true },
                { id: 'crema-avellana', name: 'Crema de Avellana', emoji: 'üå∞', available: true },
                { id: 'caramelo-salado', name: 'Caramelo Salado', emoji: 'üçØ', available: true }
            ],
            regular: [
                { id: 'mani', name: 'Man√≠', emoji: 'ü•ú', available: true },
                { id: 'mm', name: 'M&M', emoji: 'üåà', available: true },
                { id: 'blackout', name: 'Black Out', emoji: '‚ö´', available: true },
                { id: 'chispas-chocolate', name: 'Chispas de Chocolate', emoji: 'üç´', available: true },
                { id: 'galletas', name: 'Galletas', emoji: 'üç™', available: true }
            ]
        };

        // Customizable extras
        let giftOptions = [
            { id: 'gift-bow', name: 'Lazo decorativo', price: 2.00 },
            { id: 'gift-card', name: 'Tarjeta personalizada', price: 1.50 },
            { id: 'gift-both', name: 'Lazo + Tarjeta', price: 3.00 }
        ];

        let additionalOptions = [
            { id: 'extra-decoration', name: 'Decoraci√≥n extra', price: 5.00 },
            { id: 'premium-packaging', name: 'Empaque premium', price: 3.50 },
            { id: 'express-delivery', name: 'Entrega express', price: 8.00 }
        ];

        // Initialize with some sample products
        function initializeProducts() {
            products['mas-vendidos'].push({
                id: 'torta-chocolate-popular',
                name: 'Torta de Chocolate',
                price: 25.00,
                description: 'Cl√°sica y deliciosa',
                stock: 'in-stock',
                customizable: true,
                emoji: 'üéÇ',
                discount: 0,
                image: null
            });

            products['nuevos'].push(
                {
                    id: 'cupcake-unicornio',
                    name: 'Cupcake Unicornio',
                    price: 4.50,
                    description: 'M√°gico y colorido',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'üßÅ',
                    discount: 15,
                    image: null
                },
                {
                    id: 'ay-fresa-nuevo',
                    name: '¬°Ay Fresa!',
                    price: 2.00,
                    description: 'Mini Postre de bizcocho tres leches con capa de jalea de fresa artesanal y chantilly',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'üçì',
                    discount: 0,
                    image: null
                },
                {
                    id: 'maracuya-real-nuevo',
                    name: 'Maracuy√° Real',
                    price: 2.00,
                    description: 'Mini Marquesa de Maracuy√° con Crema especial refrescante de maracuy√°, capas de galleta y topping de jalea de maracuy√°',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'ü•≠',
                    discount: 0,
                    image: null
                },
                {
                    id: 'pave-leche-klim-nuevo',
                    name: 'Pave de Leche Klim',
                    price: 2.00,
                    description: 'Mini Postre con crema especial de leche Klim y capas de galletas - recordemos nuestra infancia juntos',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'ü•õ',
                    discount: 0,
                    image: null
                }
            );

            // Add sample cuchareables for box customization
            products['cuchareables'].push(
                {
                    id: 'choco-boom-mini',
                    name: 'Choco Boom Mini',
                    price: 2.00,
                    description: 'Mini postre de Brownie con Nutella y Leche condensada',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'üç´',
                    discount: 0,
                    image: null
                },
                {
                    id: 'beso-limon',
                    name: 'Beso Lim√≥n',
                    price: 2.00,
                    description: 'Mini Carlota de lim√≥n - Crema especial refrescante de lim√≥n y capas de galleta',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'üçã',
                    discount: 0,
                    image: null
                },
                {
                    id: '3leche-cremoso',
                    name: '3leche Cremoso',
                    price: 2.00,
                    description: 'Mini Postre Tres Leche con Relleno Cremoso Tipo pudin y cereza',
                    stock: 'out-of-stock',
                    customizable: false,
                    emoji: 'üç∞',
                    discount: 0,
                    image: null
                },
                {
                    id: 'ay-fresa',
                    name: '¬°Ay Fresa!',
                    price: 2.00,
                    description: 'Mini Postre de bizcocho tres leches con capa de jalea de fresa artesanal y chantilly',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'üçì',
                    discount: 0,
                    image: null
                },
                {
                    id: 'maracuya-real',
                    name: 'Maracuy√° Real',
                    price: 2.00,
                    description: 'Mini Marquesa de Maracuy√° con Crema especial refrescante de maracuy√°, capas de galleta y topping de jalea de maracuy√°',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'ü•≠',
                    discount: 0,
                    image: null
                },
                {
                    id: 'pave-leche-klim',
                    name: 'Pave de Leche Klim',
                    price: 2.00,
                    description: 'Mini Postre con crema especial de leche Klim y capas de galletas - recordemos nuestra infancia juntos',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'ü•õ',
                    discount: 0,
                    image: null
                },
                {
                    id: 'carlota-limon',
                    name: 'Carlota de Lim√≥n',
                    price: 8.50,
                    description: 'Refrescante y cremosa, el favorito de Carlos',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'üçã',
                    discount: 0,
                    image: null
                },
                {
                    id: 'tiramisu',
                    name: 'Tiramisu Individual',
                    price: 8.00,
                    description: 'Cl√°sico italiano',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'üçÆ',
                    discount: 10,
                    image: null
                },
                {
                    id: 'flan-caramelo',
                    name: 'Flan de Caramelo',
                    price: 6.50,
                    description: 'Cremoso y dulce',
                    stock: 'in-stock',
                    customizable: false,
                    emoji: 'üçÆ',
                    discount: 0,
                    image: null
                }
            );

            products['solo-para-mi'].push(
                {
                    id: 'brownie-clasico',
                    name: 'Brownie Cl√°sico',
                    price: 1.00,
                    description: 'Chocolate puro',
                    stock: 'out-of-stock',
                    customizable: false,
                    emoji: 'üç´',
                    discount: 0,
                    image: null
                },
                {
                    id: 'brownie-chispas-chocolate',
                    name: 'Brownie Chispas de Chocolate',
                    price: 2.00,
                    description: 'Con deliciosas chispas de chocolate',
                    stock: 'low-stock',
                    customizable: false,
                    emoji: 'üç´',
                    discount: 0,
                    image: null
                },
                {
                    id: 'blondie-almendras-mani',
                    name: 'Blondie Almendras y Man√≠',
                    price: 2.00,
                    description: 'Blondie con almendras y man√≠ crujiente',
                    stock: 'low-stock',
                    customizable: false,
                    emoji: 'ü•ú',
                    discount: 0,
                    image: null
                },
                {
                    id: 'brownie-mm',
                    name: 'Brownie con M&M',
                    price: 2.00,
                    description: 'Brownie con coloridos M&M',
                    stock: 'out-of-stock',
                    customizable: false,
                    emoji: 'üåà',
                    discount: 0,
                    image: null
                },
                {
                    id: 'brownie-blackout',
                    name: 'Brownie BlackOut',
                    price: 2.00,
                    description: 'Intenso brownie de chocolate negro',
                    stock: 'out-of-stock',
                    customizable: false,
                    emoji: '‚ö´',
                    discount: 0,
                    image: null
                },
                {
                    id: 'mini-trio-pack',
                    name: 'Mini Trio Pack',
                    price: 5.00,
                    description: 'Un Brownie Con Chispas, Uno M&M, Un Blondie',
                    stock: 'out-of-stock',
                    customizable: false,
                    emoji: 'üì¶',
                    discount: 0,
                    image: null
                }
            );

            // Add customizable box products
            products['cajas'].push(
                {
                    id: 'caja-4-cuchareables',
                    name: 'Caja de 4 Cuchareables',
                    price: 8.75,
                    description: 'Elige tus 4 postres cuchareables favoritos',
                    stock: 'low-stock',
                    customizable: true,
                    emoji: 'üì¶',
                    discount: 14,
                    image: null,
                    boxSize: 4,
                    boxType: 'cuchareables'
                },
                {
                    id: 'caja-4-brownies',
                    name: 'Caja de 4 Brownies',
                    price: 8.00,
                    description: 'Arma tu caja con tus toppings favoritos - 2 Creamy + 2 Regular',
                    stock: 'out-of-stock',
                    customizable: true,
                    emoji: 'üç´',
                    discount: 19,
                    image: null,
                    boxSize: 4,
                    boxType: 'brownies'
                },
                {
                    id: 'caja-6-brownies',
                    name: 'Caja de 6 Brownies',
                    price: 12.00,
                    description: 'Arma tu caja con tus toppings favoritos - 2 Creamy + 4 Regular',
                    stock: 'out-of-stock',
                    customizable: true,
                    emoji: 'üç´',
                    discount: 0,
                    image: null,
                    boxSize: 6,
                    boxType: 'brownies'
                },
                {
                    id: 'caja-6-cuchareables',
                    name: 'Caja de 6 Cuchareables',
                    price: 42.00,
                    description: 'Elige tus 6 postres cuchareables favoritos',
                    stock: 'in-stock',
                    customizable: true,
                    emoji: 'üì¶',
                    discount: 0,
                    image: null,
                    boxSize: 6,
                    boxType: 'cuchareables'
                }
            );

            products['cumpleanos'].push({
                id: 'torta-chocolate',
                name: 'Torta Cl√°sica de Chocolate',
                price: 25.00,
                description: 'Cl√°sica y deliciosa',
                stock: 'in-stock',
                customizable: true,
                emoji: 'üéÇ',
                discount: 0,
                image: null
            });

            // Add otros products (also customizable)
            products['otros'].push(
                {
                    id: 'galletas-decoradas',
                    name: 'Galletas Decoradas',
                    price: 15.00,
                    description: 'Set de 6 galletas personalizadas',
                    stock: 'in-stock',
                    customizable: true,
                    emoji: 'üç™',
                    discount: 0,
                    image: null
                },
                {
                    id: 'cake-pops',
                    name: 'Cake Pops',
                    price: 18.00,
                    description: 'Set de 8 cake pops',
                    stock: 'in-stock',
                    customizable: true,
                    emoji: 'üç≠',
                    discount: 0,
                    image: null
                }
            );

            renderAllProducts();
            updateCategoryNavigation();
        }

        function updateCategoryNavigation() {
            // Update navigation links with category names
            Object.keys(categories).forEach(categoryKey => {
                const category = categories[categoryKey];
                const navElement = document.getElementById(`nav-${categoryKey}`);
                const mobileNavElement = document.getElementById(`mobile-nav-${categoryKey}`);
                
                if (navElement) {
                    navElement.textContent = category.name.replace(/^[^\s]+ /, ''); // Remove emoji for nav
                }
                if (mobileNavElement) {
                    mobileNavElement.textContent = category.name.replace(/^[^\s]+ /, ''); // Remove emoji for nav
                }
            });
        }

        // Mobile menu toggle
        document.getElementById('mobile-menu-btn').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // Smooth scrolling
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            const offset = 80;
            const elementPosition = element.offsetTop - offset;
            
            window.scrollTo({
                top: elementPosition,
                behavior: 'smooth'
            });
        }

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                scrollToSection(targetId);
                document.getElementById('mobile-menu').classList.add('hidden');
            });
        });

        // Product rendering functions
        function renderAllProducts() {
            Object.keys(products).forEach(category => {
                renderCategoryProducts(category);
            });
        }

        function renderCategoryProducts(category) {
            const grid = document.getElementById(`${category}-grid`);
            if (!grid) return;

            grid.innerHTML = '';
            
            // Render existing products
            products[category].forEach(product => {
                grid.appendChild(createProductCard(product));
            });

            // Show placeholder cards for categories with limits
            let maxProducts = 7; // Default limit
            if (category === 'cuchareables') {
                maxProducts = 10; // Special limit for cuchareables
            }
            
            if (category === 'nuevos' || category === 'cuchareables') {
                const remainingSlots = Math.max(0, maxProducts - products[category].length);
                for (let i = 0; i < Math.min(remainingSlots, 3); i++) { // Show max 3 placeholders
                    grid.appendChild(createPlaceholderCard());
                }
            }
        }

        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'card-hover bg-white p-6 md:p-8 rounded-xl shadow-lg border relative mb-6 md:mb-0';
            
            const stockInfo = getStockInfo(product.stock);
            const isAvailable = product.stock !== 'out-of-stock';
            const hasDiscount = product.discount && product.discount > 0;
            const discountedPrice = hasDiscount ? product.price * (1 - product.discount / 100) : product.price;
            
            card.innerHTML = `
                ${product.customizable ? '<div class="absolute top-3 left-3 bg-blue-500 text-white text-xs px-2 py-1 rounded-full">‚öôÔ∏è Personalizable</div>' : ''}
                ${hasDiscount ? `<div class="absolute top-3 right-3 bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold">üè∑Ô∏è -${product.discount}%</div>` : ''}
                <div class="w-full h-48 md:h-40 ${product.image ? '' : 'bg-gradient-to-br from-pink-200 to-pink-300'} rounded-lg mb-6 flex items-center justify-center overflow-hidden">
                    ${product.image ? 
                        `<img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">` : 
                        `<span class="text-5xl">${product.emoji}</span>`
                    }
                </div>
                <h3 class="text-lg md:text-xl font-semibold text-gray-900 mb-3">${product.name}</h3>
                <p class="text-gray-600 text-sm md:text-base mb-4 leading-relaxed">${product.description}</p>
                <div class="flex justify-between items-center mb-4">
                    <div class="flex flex-col">
                        ${hasDiscount ? 
                            `<div class="text-xl md:text-2xl font-bold text-red-600">$${discountedPrice.toFixed(2)}</div>
                             <div class="text-sm text-gray-500 line-through">$${product.price.toFixed(2)}</div>` :
                            `<div class="text-xl md:text-2xl font-bold text-pink-600">$${product.price.toFixed(2)}</div>`
                        }
                    </div>
                    <div class="text-${stockInfo.color}-600 text-sm font-medium">${stockInfo.icon} ${stockInfo.text}</div>
                </div>
                <button onclick="openProductModal('${product.id}', '${product.name}', ${hasDiscount ? discountedPrice : product.price}, ${product.customizable})" 
                        ${!isAvailable ? 'disabled' : ''} 
                        class="w-full ${isAvailable ? 'bg-pink-600 hover:bg-pink-700' : 'bg-gray-300 cursor-not-allowed'} text-white py-3 px-4 rounded-lg transition-colors text-sm md:text-base font-medium">
                    ${isAvailable ? (product.customizable ? 'Personalizar' : 'Agregar al Carrito') : 'Agotado'}
                </button>
            `;
            
            return card;
        }

        function createPlaceholderCard() {
            const card = document.createElement('div');
            card.className = 'card-hover bg-gray-100 p-6 rounded-xl shadow-lg border opacity-50';
            
            card.innerHTML = `
                <div class="w-full h-40 bg-gray-200 rounded-lg mb-4 flex items-center justify-center">
                    <span class="text-gray-400">üì∑</span>
                </div>
                <h3 class="text-lg font-semibold text-gray-400 mb-2">Pr√≥ximamente</h3>
                <p class="text-gray-400 text-sm mb-3">Nuevo producto</p>
                <div class="text-gray-400 text-sm mb-3">Precio por definir</div>
                <button disabled class="w-full bg-gray-300 text-gray-500 py-2 px-4 rounded-lg text-sm cursor-not-allowed">
                    Pr√≥ximamente
                </button>
            `;
            
            return card;
        }

        function getStockInfo(stock) {
            switch(stock) {
                case 'in-stock':
                    return { icon: '‚úÖ', text: 'En Stock', color: 'green' };
                case 'low-stock':
                    return { icon: '‚ö†Ô∏è', text: 'Pocas unidades', color: 'orange' };
                case 'out-of-stock':
                    return { icon: '‚ùå', text: 'Agotado', color: 'red' };
                default:
                    return { icon: '‚úÖ', text: 'En Stock', color: 'green' };
            }
        }

        // Product modal functions
        function openProductModal(id, name, price, hasCustomization = false) {
            if (!storeOpen) {
                alert('üî¥ La tienda est√° cerrada temporalmente. No se pueden realizar pedidos en este momento.');
                return;
            }
            
            // Find the actual product to get all its properties
            let productData = null;
            Object.keys(products).forEach(category => {
                const found = products[category].find(p => p.id === id);
                if (found) productData = found;
            });
            
            // Check if this is a box product
            const isBoxProduct = id.includes('caja') || name.toLowerCase().includes('caja');
            
            currentProduct = { 
                id, 
                name, 
                basePrice: price, 
                hasCustomization,
                isBox: isBoxProduct,
                boxSize: isBoxProduct ? (productData ? productData.boxSize : getBoxSize(name)) : 0,
                boxType: productData ? productData.boxType : null
            };
            
            document.getElementById('modal-title').textContent = name;
            document.getElementById('product-modal').classList.remove('hidden');
            resetModal();
            
            // Show/hide customization options based on product type
            const giftOptions = document.getElementById('gift-options');
            const additionalOptions = document.getElementById('additional-options');
            const customizationToggle = document.getElementById('customization-toggle');
            const boxCustomization = document.getElementById('box-customization');
            
            if (isBoxProduct && hasCustomization) {
                giftOptions.style.display = 'block';
                additionalOptions.style.display = 'block';
                customizationToggle.style.display = 'block';
                boxCustomization.style.display = 'none'; // Initially hidden until toggle is enabled
                document.getElementById('enable-customization').checked = false;
            } else if (hasCustomization && !isBoxProduct) {
                giftOptions.style.display = 'block';
                additionalOptions.style.display = 'block';
                customizationToggle.style.display = 'none';
                boxCustomization.style.display = 'none';
            } else {
                giftOptions.style.display = 'none';
                additionalOptions.style.display = 'none';
                customizationToggle.style.display = 'none';
                boxCustomization.style.display = 'none';
            }
            
            updatePrice();
        }

        function closeProductModal() {
            document.getElementById('product-modal').classList.add('hidden');
        }

        function resetModal() {
            // Reset all checkboxes
            document.querySelectorAll('#product-modal input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('quantity').textContent = '1';
            document.getElementById('special-instructions').value = '';
            
            // Reset box customization
            if (currentProduct && currentProduct.isBox) {
                resetBoxSelection();
            }
        }

        function resetBoxSelection() {
            if (currentProduct.boxType === 'brownies') {
                // Reset brownie toppings
                document.querySelectorAll('.topping-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                updateBrownieBoxSummary();
            } else {
                // Reset flavor quantities for cuchareables
                document.querySelectorAll('.flavor-quantity').forEach(input => {
                    input.value = '0';
                });
                updateBoxSummary();
            }
        }

        function toggleCustomization() {
            const isEnabled = document.getElementById('enable-customization').checked;
            const boxCustomization = document.getElementById('box-customization');
            
            if (isEnabled) {
                boxCustomization.style.display = 'block';
                loadBoxCustomization();
            } else {
                boxCustomization.style.display = 'none';
                resetBoxSelection();
            }
        }

        function getBoxSize(productName) {
            // Extract box size from product name
            const match = productName.match(/(\d+)/);
            return match ? parseInt(match[1]) : 0;
        }



        function updatePrice() {
            let total = currentProduct.basePrice;
            const quantity = parseInt(document.getElementById('quantity').textContent);

            // Gift options (mutually exclusive)
            if (document.getElementById('gift-bow').checked) total += 2;
            if (document.getElementById('gift-card').checked) total += 1.5;
            if (document.getElementById('gift-both').checked) {
                total += 3;
                // Uncheck individual options if both is selected
                document.getElementById('gift-bow').checked = false;
                document.getElementById('gift-card').checked = false;
            }

            // If individual options are selected, uncheck both
            if (document.getElementById('gift-bow').checked || document.getElementById('gift-card').checked) {
                document.getElementById('gift-both').checked = false;
            }

            // Additional options
            if (document.getElementById('extra-decoration').checked) total += 5;
            if (document.getElementById('premium-packaging').checked) total += 3.5;
            if (document.getElementById('express-delivery').checked) total += 8;

            total *= quantity;
            document.getElementById('modal-price').textContent = `$${total.toFixed(2)}`;
        }

        function changeQuantity(change) {
            const quantityElement = document.getElementById('quantity');
            let quantity = parseInt(quantityElement.textContent) + change;
            if (quantity < 1) quantity = 1;
            quantityElement.textContent = quantity;
            updatePrice();
        }

        function addToCart() {
            // Validate box selection if it's a box product and customization is enabled
            if (currentProduct.isBox && document.getElementById('enable-customization').checked) {
                if (currentProduct.boxType === 'brownies') {
                    // Validate brownie toppings selection
                    const creamySelected = document.querySelectorAll('.creamy-topping:checked').length;
                    const regularSelected = document.querySelectorAll('.regular-topping:checked').length;
                    const maxCreamy = getMaxToppings('creamy');
                    const maxRegular = getMaxToppings('regular');
                    
                    if (creamySelected !== maxCreamy || regularSelected !== maxRegular) {
                        alert(`Por favor selecciona exactamente ${maxCreamy} Creamy Toppings y ${maxRegular} Regular Toppings.\n\nActualmente tienes: ${creamySelected} Creamy + ${regularSelected} Regular`);
                        return;
                    }
                } else {
                    // Validate cuchareables selection
                    const totalSelected = getCurrentBoxTotal();
                    if (totalSelected !== currentProduct.boxSize) {
                        alert(`Por favor selecciona exactamente ${currentProduct.boxSize} productos para tu caja. Actualmente tienes ${totalSelected} seleccionados.`);
                        return;
                    }
                }
            }
            
            const quantity = parseInt(document.getElementById('quantity').textContent);
            const price = parseFloat(document.getElementById('modal-price').textContent.replace('$', ''));
            
            const item = {
                id: currentProduct.id + '_' + Date.now(),
                name: currentProduct.name,
                quantity: quantity,
                price: price,
                unitPrice: price / quantity,
                options: getSelectedOptions(),
                instructions: document.getElementById('special-instructions').value,
                boxSelection: (currentProduct.isBox && document.getElementById('enable-customization').checked) ? getBoxSelection() : null
            };

            cart.push(item);
            updateCartDisplay();
            closeProductModal();
            
            // Show success message
            alert(`‚úÖ ${currentProduct.name} agregado al carrito!`);
        }

        function getBoxSelection() {
            if (!currentProduct.isBox) return null;
            
            const selection = [];
            
            if (currentProduct.boxType === 'brownies') {
                // Get selected brownie toppings
                const creamyToppings = [];
                const regularToppings = [];
                
                document.querySelectorAll('.creamy-topping:checked').forEach(checkbox => {
                    const toppingId = checkbox.id.replace('topping-creamy-', '');
                    const topping = brownieToppings.creamy.find(t => t.id === toppingId);
                    if (topping) {
                        creamyToppings.push({
                            name: topping.name,
                            emoji: topping.emoji,
                            type: 'creamy'
                        });
                    }
                });
                
                document.querySelectorAll('.regular-topping:checked').forEach(checkbox => {
                    const toppingId = checkbox.id.replace('topping-regular-', '');
                    const topping = brownieToppings.regular.find(t => t.id === toppingId);
                    if (topping) {
                        regularToppings.push({
                            name: topping.name,
                            emoji: topping.emoji,
                            type: 'regular'
                        });
                    }
                });
                
                return {
                    type: 'brownies',
                    creamy: creamyToppings,
                    regular: regularToppings
                };
            } else if (currentProduct.boxType === 'cuchareables') {
                // Get selected cuchareables flavors
                document.querySelectorAll('.flavor-quantity').forEach(input => {
                    const quantity = parseInt(input.value) || 0;
                    if (quantity > 0) {
                        const flavorId = input.id.replace('flavor-', '');
                        const flavor = products['cuchareables'].find(p => p.id === flavorId);
                        
                        if (flavor) {
                            selection.push({
                                name: flavor.name,
                                quantity: quantity,
                                emoji: flavor.emoji
                            });
                        }
                    }
                });
                
                return {
                    type: 'cuchareables',
                    flavors: selection
                };
            }
            
            return null;
        }

        function getSelectedOptions() {
            const options = [];
            if (document.getElementById('gift-bow').checked) options.push('Lazo decorativo');
            if (document.getElementById('gift-card').checked) options.push('Tarjeta personalizada');
            if (document.getElementById('gift-both').checked) options.push('Lazo + Tarjeta');
            if (document.getElementById('extra-decoration').checked) options.push('Decoraci√≥n extra');
            if (document.getElementById('premium-packaging').checked) options.push('Empaque premium');
            if (document.getElementById('express-delivery').checked) options.push('Entrega express');
            return options;
        }

        function updateCartDisplay() {
            document.getElementById('cart-count').textContent = cart.length;
            document.getElementById('cart-count-mobile').textContent = cart.length;
            
            const cartItemsContainer = document.getElementById('cart-items');
            cartItemsContainer.innerHTML = '';

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Tu carrito est√° vac√≠o</p>';
                document.getElementById('cart-subtotal').textContent = '$0.00';
                document.getElementById('delivery-cost').textContent = 'Gratis';
                document.getElementById('cart-total').textContent = '$0.00';
                
                // Hide coupon discount line
                document.getElementById('coupon-discount-line').classList.add('hidden');
                return;
            }

            let subtotal = 0;
            cart.forEach((item, index) => {
                subtotal += item.price;
                
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item border rounded-lg p-4';
                
                let boxSelectionHTML = '';
                if (item.boxSelection) {
                    if (item.boxSelection.type === 'brownies') {
                        boxSelectionHTML = `
                            <div class="text-sm text-gray-500 mt-2">
                                <strong>Toppings seleccionados:</strong>
                                <div class="mt-1 space-y-1">
                                    <div class="text-xs font-medium text-amber-700">üçØ Creamy Toppings:</div>
                                    ${item.boxSelection.creamy.map(topping => 
                                        `<div class="flex items-center space-x-2 ml-2">
                                            <span>${topping.emoji}</span>
                                            <span>${topping.name}</span>
                                        </div>`
                                    ).join('')}
                                    <div class="text-xs font-medium text-amber-700 mt-2">üç´ Regular Toppings:</div>
                                    ${item.boxSelection.regular.map(topping => 
                                        `<div class="flex items-center space-x-2 ml-2">
                                            <span>${topping.emoji}</span>
                                            <span>${topping.name}</span>
                                        </div>`
                                    ).join('')}
                                </div>
                            </div>
                        `;
                    } else if (item.boxSelection.type === 'cuchareables' && item.boxSelection.flavors && item.boxSelection.flavors.length > 0) {
                        boxSelectionHTML = `
                            <div class="text-sm text-gray-500 mt-2">
                                <strong>Sabores seleccionados:</strong>
                                <div class="mt-1 space-y-1">
                                    ${item.boxSelection.flavors.map(flavor => 
                                        `<div class="flex items-center space-x-2">
                                            <span>${flavor.emoji}</span>
                                            <span>${flavor.name} x${flavor.quantity}</span>
                                        </div>`
                                    ).join('')}
                                </div>
                            </div>
                        `;
                    }
                }
                
                itemElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-semibold">${item.name}</h4>
                            <p class="text-gray-600">Cantidad: ${item.quantity}</p>
                            ${item.options.length > 0 ? `<p class="text-sm text-gray-500">Extras: ${item.options.join(', ')}</p>` : ''}
                            ${boxSelectionHTML}
                            ${item.instructions ? `<p class="text-sm text-gray-500">Instrucciones: ${item.instructions}</p>` : ''}
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-pink-600">$${item.price.toFixed(2)}</p>
                            <button onclick="removeFromCart(${index})" class="text-red-500 hover:text-red-700 text-sm">Eliminar</button>
                        </div>
                    </div>
                `;
                cartItemsContainer.appendChild(itemElement);
            });

            // Calculate delivery cost
            const deliveryMethod = document.querySelector('input[name="delivery-method"]:checked');
            let deliveryCost = 0;
            if (deliveryMethod && deliveryMethod.value === 'delivery' && deliverySettings.enabled) {
                deliveryCost = deliverySettings.cost;
            }

            // Calculate coupon discount
            let couponDiscount = 0;
            if (appliedCoupon) {
                couponDiscount = calculateCouponDiscount(subtotal, appliedCoupon);
                document.getElementById('coupon-discount-line').classList.remove('hidden');
                document.getElementById('applied-coupon-code').textContent = appliedCoupon.code;
                document.getElementById('coupon-discount-amount').textContent = `-$${couponDiscount.toFixed(2)}`;
            } else {
                document.getElementById('coupon-discount-line').classList.add('hidden');
            }

            const total = Math.max(0, subtotal + deliveryCost - couponDiscount);

            document.getElementById('cart-subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('delivery-cost').textContent = deliveryCost > 0 ? `$${deliveryCost.toFixed(2)}` : 'Gratis';
            document.getElementById('cart-total').textContent = `$${total.toFixed(2)}`;
        }

        // Coupon functions
        function applyCoupon() {
            const couponCode = document.getElementById('coupon-code').value.trim().toUpperCase();
            const couponMessage = document.getElementById('coupon-message');
            const couponText = document.getElementById('coupon-text');
            
            if (!couponCode) {
                showCouponMessage('Por favor ingresa un c√≥digo de cup√≥n.', 'error');
                return;
            }
            
            // Find the coupon
            const coupon = coupons.find(c => c.code === couponCode && c.active);
            
            if (!coupon) {
                showCouponMessage('C√≥digo de cup√≥n inv√°lido o expirado.', 'error');
                return;
            }
            
            // Check if coupon is expired
            if (coupon.expiryDate && new Date(coupon.expiryDate) < new Date()) {
                showCouponMessage('Este cup√≥n ha expirado.', 'error');
                return;
            }
            
            // Check usage limit
            if (coupon.usageLimit && coupon.usedCount >= coupon.usageLimit) {
                showCouponMessage('Este cup√≥n ha alcanzado su l√≠mite de usos.', 'error');
                return;
            }
            
            // Check minimum purchase
            const subtotal = parseFloat(document.getElementById('cart-subtotal').textContent.replace('$', ''));
            if (coupon.minimumPurchase && subtotal < coupon.minimumPurchase) {
                showCouponMessage(`Este cup√≥n requiere una compra m√≠nima de $${coupon.minimumPurchase.toFixed(2)}.`, 'error');
                return;
            }
            
            // Apply coupon
            appliedCoupon = coupon;
            updateCartDisplay();
            showCouponMessage(`¬°Cup√≥n aplicado! ${coupon.description || 'Descuento aplicado correctamente.'}`, 'success');
            
            // Disable coupon input
            document.getElementById('coupon-code').disabled = true;
            document.querySelector('button[onclick="applyCoupon()"]').textContent = 'Remover';
            document.querySelector('button[onclick="applyCoupon()"]').onclick = removeCoupon;
        }
        
        function removeCoupon() {
            appliedCoupon = null;
            updateCartDisplay();
            
            // Reset coupon input
            document.getElementById('coupon-code').value = '';
            document.getElementById('coupon-code').disabled = false;
            document.querySelector('button[onclick="removeCoupon()"]').textContent = 'Aplicar';
            document.querySelector('button[onclick="removeCoupon()"]').onclick = applyCoupon;
            
            showCouponMessage('Cup√≥n removido.', 'info');
        }
        
        function showCouponMessage(message, type) {
            const couponMessage = document.getElementById('coupon-message');
            const couponText = document.getElementById('coupon-text');
            
            couponText.textContent = message;
            couponMessage.classList.remove('hidden', 'bg-red-50', 'text-red-800', 'bg-green-50', 'text-green-800', 'bg-blue-50', 'text-blue-800');
            
            if (type === 'error') {
                couponMessage.classList.add('bg-red-50', 'text-red-800');
            } else if (type === 'success') {
                couponMessage.classList.add('bg-green-50', 'text-green-800');
            } else {
                couponMessage.classList.add('bg-blue-50', 'text-blue-800');
            }
            
            // Hide message after 5 seconds
            setTimeout(() => {
                couponMessage.classList.add('hidden');
            }, 5000);
        }
        
        function calculateCouponDiscount(subtotal, coupon) {
            if (coupon.type === 'percentage') {
                return subtotal * (coupon.value / 100);
            } else if (coupon.type === 'fixed') {
                return Math.min(coupon.value, subtotal);
            }
            return 0;
        }

        // Delivery management functions
        function toggleDeliveryService() {
            deliverySettings.enabled = document.getElementById('enable-delivery').checked;
            updateDeliveryOptions();
        }



        function updateDeliveryOptions() {
            const deliveryOption = document.getElementById('delivery-option');
            const deliveryOptionText = document.getElementById('delivery-option-text');
            const deliveryInput = document.querySelector('input[name="delivery-method"][value="delivery"]');
            const deliveryZoneInfo = document.getElementById('delivery-zone-info');
            const deliveryZoneDisplay = document.getElementById('delivery-zone-display');

            if (deliverySettings.enabled) {
                deliveryOption.classList.remove('opacity-50');
                deliveryInput.disabled = false;
                deliveryOptionText.textContent = `üöö Delivery (+$${deliverySettings.cost.toFixed(2)})`;
                deliveryZoneInfo.classList.remove('hidden');
                deliveryZoneDisplay.textContent = deliverySettings.zone;
            } else {
                deliveryOption.classList.add('opacity-50');
                deliveryInput.disabled = true;
                deliveryInput.checked = false;
                document.querySelector('input[name="delivery-method"][value="pickup"]').checked = true;
                deliveryOptionText.textContent = 'üöö Delivery (Deshabilitado)';
                deliveryZoneInfo.classList.add('hidden');
            }
            
            updateCartDisplay();
        }

        function saveDeliverySettings() {
            deliverySettings.cost = parseFloat(document.getElementById('delivery-cost-input').value);
            deliverySettings.zone = document.getElementById('delivery-zone').value;
            
            updateDeliveryOptions();
            alert('üöö Configuraci√≥n de delivery guardada exitosamente!');
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartDisplay();
        }

        function toggleCart() {
            document.getElementById('cart-modal').classList.toggle('hidden');
            updateCartDisplay();
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('file-preview').classList.remove('hidden');
            }
        }

        function showPaymentInfo() {
            const paymentMethod = document.querySelector('input[name="payment-method"]:checked');
            const paymentInfo = document.getElementById('payment-info');
            const yappyInfo = document.getElementById('yappy-info');
            const transferInfo = document.getElementById('transfer-info');
            
            if (paymentMethod) {
                paymentInfo.classList.remove('hidden');
                
                // Hide all payment info sections first
                yappyInfo.classList.add('hidden');
                transferInfo.classList.add('hidden');
                
                if (paymentMethod.value === 'yappy') {
                    yappyInfo.classList.remove('hidden');
                    document.getElementById('yappy-number').textContent = `N√∫mero: ${contactInfo.yappyNumber}`;
                } else if (paymentMethod.value === 'transfer') {
                    transferInfo.classList.remove('hidden');
                    document.getElementById('bank-account').textContent = `Cuenta: ${contactInfo.bankAccount}`;
                }
            } else {
                paymentInfo.classList.add('hidden');
            }
            

        }

        function updateDeliveryMessage() {
            const deliveryDate = document.getElementById('delivery-date');
            const deliveryMessage = document.getElementById('delivery-message');
            const deliveryText = document.getElementById('delivery-text');
            const birthdayMessage = document.getElementById('birthday-message');
            
            if (deliveryDate.value) {
                const selectedDate = new Date(deliveryDate.value);
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(today.getDate() + 1);
                
                // Set minimum date to tomorrow
                const minDate = tomorrow.toISOString().split('T')[0];
                deliveryDate.min = minDate;
                
                // Format date for display
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                const formattedDate = selectedDate.toLocaleDateString('es-ES', options);
                
                deliveryText.textContent = `Tu pedido estar√° listo el ${formattedDate}`;
                deliveryMessage.classList.remove('hidden');
                
                // Show birthday message for birthday cakes
                if (currentProduct && currentProduct.name && currentProduct.name.toLowerCase().includes('cumplea√±os')) {
                    birthdayMessage.classList.remove('hidden');
                } else {
                    birthdayMessage.classList.add('hidden');
                }
            } else {
                deliveryMessage.classList.add('hidden');
                birthdayMessage.classList.add('hidden');
            }
        }

        async function processOrder() {
            if (!storeOpen) {
                alert('üî¥ La tienda est√° cerrada temporalmente. No se pueden realizar pedidos en este momento.');
                return;
            }

            // Validate required fields
            const name = document.getElementById('customer-name').value.trim();
            const phone = document.getElementById('customer-phone').value.trim();
            const email = document.getElementById('customer-email').value.trim();
            const address = document.getElementById('delivery-address').value.trim();
            const deliveryMethod = document.querySelector('input[name="delivery-method"]:checked');
            const paymentMethod = document.querySelector('input[name="payment-method"]:checked');
            const paymentProof = document.getElementById('payment-proof').files[0];

            if (!name || !phone || !email) {
                alert('‚ùå Por favor completa todos los campos de informaci√≥n personal (Nombre, Tel√©fono, Email).');
                return;
            }

            if (!deliveryMethod) {
                alert('‚ùå Por favor selecciona un m√©todo de entrega.');
                return;
            }

            if (deliveryMethod.value === 'delivery' && !address) {
                alert('‚ùå Por favor completa la direcci√≥n para delivery.');
                return;
            }

            if (!paymentMethod) {
                alert('‚ùå Por favor selecciona un m√©todo de pago.');
                return;
            }

            if (!paymentProof) {
                alert('‚ùå Por favor adjunta el comprobante de pago.');
                return;
            }

            if (cart.length === 0) {
                alert('‚ùå Tu carrito est√° vac√≠o. Agrega productos antes de realizar el pedido.');
                return;
            }

            try {
                // Process payment proof file
                let paymentProofData = null;
                if (paymentProof) {
                    const reader = new FileReader();
                    paymentProofData = await new Promise((resolve) => {
                        reader.onload = function(e) {
                            resolve({
                                name: paymentProof.name,
                                type: paymentProof.type,
                                size: paymentProof.size,
                                data: e.target.result
                            });
                        };
                        reader.readAsDataURL(paymentProof);
                    });
                }

                // Create order
                const orderId = 'ORD-' + Date.now();
                const order = {
                    id: orderId,
                    customer: { 
                        name, 
                        phone, 
                        email, 
                        address: address || 'Recoger en tienda' 
                    },
                    deliveryMethod: deliveryMethod.value,
                    paymentMethod: paymentMethod.value,
                    items: [...cart],
                    total: document.getElementById('cart-total').textContent,
                    status: 'pending',
                    paymentStatus: 'pending',
                    paymentReceipt: paymentProofData,
                    timestamp: new Date().toISOString(),
                    date: new Date().toLocaleDateString('es-ES'),
                    time: new Date().toLocaleTimeString('es-ES'),
                    orderNumber: orderId.slice(-6)
                };

                // Add to orders list
                orders.push(order);
                updateAdminStats();
                
                alert(`üéâ ¬°Pedido confirmado exitosamente!\n\nüìã N√∫mero de pedido: #${order.orderNumber}\nüë§ Cliente: ${name}\nüí∞ Total: ${order.total}\n\n‚úÖ Hemos recibido tu pedido y comprobante de pago.\nüìû Te contactaremos pronto para confirmar los detalles de entrega.`);
                
                // Clear cart and close modal
                cart = [];
                updateCartDisplay();
                toggleCart();
                
                // Reset form
                resetOrderForm();
                
            } catch (error) {
                console.error('Error processing order:', error);
                alert('‚ùå Error al procesar el pedido. Por favor int√©ntalo de nuevo.');
            }
        }

        function resetOrderForm() {
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('customer-email').value = '';
            document.getElementById('delivery-address').value = '';
            document.querySelectorAll('input[name="delivery-method"]').forEach(radio => radio.checked = false);
            document.querySelectorAll('input[name="payment-method"]').forEach(radio => radio.checked = false);
            document.getElementById('payment-proof').value = '';
            document.getElementById('file-preview').classList.add('hidden');
            document.getElementById('payment-info').classList.add('hidden');
        }

        // Admin authentication
        let adminPassword = 'admin123';
        
        function showAdminLogin() {
            document.getElementById('admin-login-modal').classList.remove('hidden');
        }
        
        function closeAdminLogin() {
            document.getElementById('admin-login-modal').classList.add('hidden');
            document.getElementById('admin-password').value = '';
        }
        
        // Handle admin login
        document.getElementById('admin-login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            
            if (password === adminPassword) {
                isAdminAuthenticated = true;
                closeAdminLogin();
                toggleAdmin();
                alert('‚úÖ Acceso concedido. Bienvenido al panel de administraci√≥n.');
            } else {
                alert('‚ùå Contrase√±a incorrecta. Int√©ntalo de nuevo.');
                document.getElementById('admin-password').value = '';
            }
        });
        
        // Keyboard shortcut for admin access (Ctrl+Shift+A)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                if (!isAdminAuthenticated) {
                    showAdminLogin();
                } else {
                    toggleAdmin();
                }
            }
        });

        // Admin functions
        function toggleAdmin() {
            if (!isAdminAuthenticated) {
                showAdminLogin();
                return;
            }
            document.getElementById('admin-modal').classList.toggle('hidden');
            updateAdminStats();
            showAdminTab('store');
        }

        function showAdminTab(tab) {
            // Hide all content
            document.querySelectorAll('.admin-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.admin-tab, .admin-tab-active').forEach(tabBtn => {
                tabBtn.className = 'admin-tab py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            
            // Show selected content and activate tab
            document.getElementById(`${tab}-content`).classList.remove('hidden');
            document.getElementById(`${tab}-tab`).className = 'admin-tab-active py-2 px-1 border-b-2 border-pink-500 font-medium text-sm text-pink-600';
            
            if (tab === 'products') {
                showCategoryProducts('mas-vendidos');
            } else if (tab === 'orders') {
                displayOrders();
                updateOrdersSummary();
            } else if (tab === 'categories') {
                loadCategoriesEditor();
            } else if (tab === 'coupons') {
                loadCouponsManager();
            } else if (tab === 'settings') {
                loadStoreSettings();
            }
        }

        // Coupon management functions
        function loadCouponsManager() {
            displayCoupons();
            
            // Add form event listener
            document.getElementById('add-coupon-form').addEventListener('submit', function(e) {
                e.preventDefault();
                createCoupon();
            });
        }
        
        function createCoupon() {
            const code = document.getElementById('new-coupon-code').value.trim().toUpperCase();
            const type = document.getElementById('new-coupon-type').value;
            const value = parseFloat(document.getElementById('new-coupon-value').value);
            const minimum = parseFloat(document.getElementById('new-coupon-minimum').value) || 0;
            const expiry = document.getElementById('new-coupon-expiry').value;
            const limit = parseInt(document.getElementById('new-coupon-limit').value) || null;
            const description = document.getElementById('new-coupon-description').value.trim();
            
            // Validate
            if (!code || !type || !value) {
                alert('Por favor completa todos los campos obligatorios.');
                return;
            }
            
            // Check if code already exists
            if (coupons.find(c => c.code === code)) {
                alert('Ya existe un cup√≥n con este c√≥digo.');
                return;
            }
            
            // Create coupon
            const newCoupon = {
                id: 'coupon-' + Date.now(),
                code: code,
                type: type,
                value: value,
                minimumPurchase: minimum,
                expiryDate: expiry || null,
                usageLimit: limit,
                usedCount: 0,
                description: description,
                active: true,
                createdDate: new Date().toISOString()
            };
            
            coupons.push(newCoupon);
            displayCoupons();
            
            // Reset form
            document.getElementById('add-coupon-form').reset();
            
            alert(`üé´ Cup√≥n "${code}" creado exitosamente!`);
        }
        
        function displayCoupons() {
            const activeCoupons = coupons.filter(c => c.active && (!c.expiryDate || new Date(c.expiryDate) >= new Date()));
            const inactiveCoupons = coupons.filter(c => !c.active || (c.expiryDate && new Date(c.expiryDate) < new Date()));
            
            // Update counts
            document.getElementById('active-coupons-count').textContent = activeCoupons.length;
            document.getElementById('inactive-coupons-count').textContent = inactiveCoupons.length;
            
            // Display active coupons
            const activeList = document.getElementById('active-coupons-list');
            if (activeCoupons.length === 0) {
                activeList.innerHTML = '<p class="text-gray-500 text-center py-8">No hay cupones activos</p>';
            } else {
                activeList.innerHTML = activeCoupons.map(coupon => createCouponCard(coupon, true)).join('');
            }
            
            // Display inactive coupons
            const inactiveList = document.getElementById('inactive-coupons-list');
            if (inactiveCoupons.length === 0) {
                inactiveList.innerHTML = '<p class="text-gray-500 text-center py-8">No hay cupones inactivos</p>';
            } else {
                inactiveList.innerHTML = inactiveCoupons.map(coupon => createCouponCard(coupon, false)).join('');
            }
        }
        
        function createCouponCard(coupon, isActive) {
            const discountText = coupon.type === 'percentage' ? `${coupon.value}%` : `$${coupon.value.toFixed(2)}`;
            const expiryText = coupon.expiryDate ? new Date(coupon.expiryDate).toLocaleDateString('es-ES') : 'Sin expiraci√≥n';
            const usageText = coupon.usageLimit ? `${coupon.usedCount}/${coupon.usageLimit} usos` : `${coupon.usedCount} usos`;
            
            return `
                <div class="border rounded-lg p-4 ${isActive ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="text-lg font-bold ${isActive ? 'text-green-800' : 'text-gray-600'}">${coupon.code}</h4>
                            <p class="text-sm ${isActive ? 'text-green-600' : 'text-gray-500'}">${coupon.description || 'Sin descripci√≥n'}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-bold ${isActive ? 'text-green-600' : 'text-gray-500'}">${discountText} OFF</div>
                            <div class="text-xs ${isActive ? 'text-green-500' : 'text-gray-400'}">${coupon.type === 'percentage' ? 'Porcentaje' : 'Monto fijo'}</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                        <div>
                            <span class="font-medium">Compra m√≠nima:</span>
                            <span class="${isActive ? 'text-green-700' : 'text-gray-600'}">$${coupon.minimumPurchase.toFixed(2)}</span>
                        </div>
                        <div>
                            <span class="font-medium">Expira:</span>
                            <span class="${isActive ? 'text-green-700' : 'text-gray-600'}">${expiryText}</span>
                        </div>
                        <div>
                            <span class="font-medium">Usos:</span>
                            <span class="${isActive ? 'text-green-700' : 'text-gray-600'}">${usageText}</span>
                        </div>
                        <div>
                            <span class="font-medium">Estado:</span>
                            <span class="${isActive ? 'text-green-600 font-medium' : 'text-red-600 font-medium'}">${isActive ? '‚úÖ Activo' : '‚ùå Inactivo'}</span>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        ${isActive ? `
                            <button onclick="toggleCouponStatus('${coupon.id}')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                ‚è∏Ô∏è Desactivar
                            </button>
                        ` : `
                            <button onclick="toggleCouponStatus('${coupon.id}')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                ‚ñ∂Ô∏è Activar
                            </button>
                        `}
                        <button onclick="editCoupon('${coupon.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            ‚úèÔ∏è Editar
                        </button>
                        <button onclick="deleteCoupon('${coupon.id}')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            üóëÔ∏è Eliminar
                        </button>
                        <button onclick="copyCouponCode('${coupon.code}')" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            üìã Copiar
                        </button>
                    </div>
                </div>
            `;
        }
        
        function toggleCouponStatus(couponId) {
            const coupon = coupons.find(c => c.id === couponId);
            if (coupon) {
                coupon.active = !coupon.active;
                displayCoupons();
                alert(`üé´ Cup√≥n "${coupon.code}" ${coupon.active ? 'activado' : 'desactivado'} exitosamente.`);
            }
        }
        
        function editCoupon(couponId) {
            const coupon = coupons.find(c => c.id === couponId);
            if (!coupon) return;
            
            // Fill form with current coupon data
            document.getElementById('new-coupon-code').value = coupon.code;
            document.getElementById('new-coupon-type').value = coupon.type;
            document.getElementById('new-coupon-value').value = coupon.value;
            document.getElementById('new-coupon-minimum').value = coupon.minimumPurchase;
            document.getElementById('new-coupon-expiry').value = coupon.expiryDate || '';
            document.getElementById('new-coupon-limit').value = coupon.usageLimit || '';
            document.getElementById('new-coupon-description').value = coupon.description || '';
            
            // Change form to edit mode
            const form = document.getElementById('add-coupon-form');
            form.dataset.editId = couponId;
            form.querySelector('button[type="submit"]').textContent = 'üíæ Guardar Cambios';
            
            // Scroll to form
            form.scrollIntoView({ behavior: 'smooth' });
        }
        
        function deleteCoupon(couponId) {
            const coupon = coupons.find(c => c.id === couponId);
            if (coupon && confirm(`¬øEst√°s seguro de que quieres eliminar el cup√≥n "${coupon.code}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
                coupons = coupons.filter(c => c.id !== couponId);
                displayCoupons();
                alert(`üóëÔ∏è Cup√≥n "${coupon.code}" eliminado exitosamente.`);
            }
        }
        
        function copyCouponCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                alert(`üìã C√≥digo "${code}" copiado al portapapeles.`);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert(`üìã C√≥digo "${code}" copiado al portapapeles.`);
            });
        }

        function showCategoryProducts(category) {
            currentCategory = category;
            
            // Update category tabs
            document.querySelectorAll('.category-tab, .category-tab-active').forEach(tab => {
                tab.className = 'category-tab whitespace-nowrap py-2 px-3 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700';
            });
            document.getElementById(`cat-${category}`).className = 'category-tab-active whitespace-nowrap py-2 px-3 border-b-2 border-pink-500 font-medium text-sm text-pink-600';
            
            // Display products for this category
            displayAdminProducts(category);
        }

        function displayAdminProducts(category) {
            const grid = document.getElementById('admin-products-grid');
            grid.innerHTML = '';
            
            products[category].forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'bg-white border rounded-lg p-4';
                
                const stockInfo = getStockInfo(product.stock);
                const hasDiscount = product.discount && product.discount > 0;
                const discountedPrice = hasDiscount ? product.price * (1 - product.discount / 100) : product.price;
                
                card.innerHTML = `
                    ${hasDiscount ? `<div class="absolute top-2 right-2 bg-red-500 text-white text-xs px-1 py-0.5 rounded font-bold">-${product.discount}%</div>` : ''}
                    <div class="w-full h-32 ${product.image ? '' : 'bg-gradient-to-br from-pink-200 to-pink-300'} rounded-lg mb-3 flex items-center justify-center overflow-hidden">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">` : 
                            `<span class="text-3xl">${product.emoji}</span>`
                        }
                    </div>
                    <h4 class="font-semibold text-sm mb-1">${product.name}</h4>
                    <p class="text-xs text-gray-600 mb-2">${product.description}</p>
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex flex-col">
                            ${hasDiscount ? 
                                `<span class="font-bold text-red-600 text-sm">$${discountedPrice.toFixed(2)}</span>
                                 <span class="text-xs text-gray-500 line-through">$${product.price.toFixed(2)}</span>` :
                                `<span class="font-bold text-pink-600">$${product.price.toFixed(2)}</span>`
                            }
                        </div>
                        <span class="text-xs text-${stockInfo.color}-600">${stockInfo.icon} ${stockInfo.text}</span>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editProduct('${category}', ${index})" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white text-xs py-1 px-2 rounded transition-colors">
                            ‚úèÔ∏è Editar
                        </button>
                        <button onclick="deleteProduct('${category}', ${index})" class="flex-1 bg-red-500 hover:bg-red-600 text-white text-xs py-1 px-2 rounded transition-colors">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            // Show available slots
            let maxProducts = 7; // Default limit
            if (category === 'cuchareables') {
                maxProducts = 10; // Special limit for cuchareables
            }
            if (category === 'solo-para-mi') {
                maxProducts = 10; // Special limit for solo-para-mi (Tentaciones)
            }
            
            const remainingSlots = maxProducts - products[category].length;
            if (remainingSlots > 0) {
                const slotsInfo = document.createElement('div');
                slotsInfo.className = 'col-span-full text-center text-gray-500 text-sm py-4';
                slotsInfo.textContent = `${remainingSlots} espacios disponibles en esta categor√≠a (m√°ximo ${maxProducts})`;
                grid.appendChild(slotsInfo);
            }
        }

        function showAddProductModal() {
            document.getElementById('add-product-modal').classList.remove('hidden');
            document.getElementById('product-category').value = currentCategory;
        }

        function closeAddProductModal() {
            document.getElementById('add-product-modal').classList.add('hidden');
            document.getElementById('add-product-form').reset();
            document.getElementById('product-image-preview').classList.add('hidden');
            
            // Reset box options
            document.getElementById('box-type-selection').classList.add('hidden');
            document.getElementById('box-size-selection').classList.add('hidden');
            
            // Reset form to add mode
            document.querySelector('#add-product-modal h2').textContent = '‚ûï Agregar Producto';
            document.querySelector('#add-product-form button[type="submit"]').textContent = 'Agregar Producto';
            
            // Clear edit info
            delete document.getElementById('add-product-form').dataset.editCategory;
            delete document.getElementById('add-product-form').dataset.editIndex;
        }

        function handleProductImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    alert('La imagen es muy grande. Por favor selecciona una imagen menor a 5MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-img').src = e.target.result;
                    document.getElementById('product-image-preview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        // Show/hide box options based on customizable checkbox
        document.getElementById('product-customizable').addEventListener('change', function() {
            const boxTypeSelection = document.getElementById('box-type-selection');
            const boxSizeSelection = document.getElementById('box-size-selection');
            
            if (this.checked) {
                boxTypeSelection.classList.remove('hidden');
            } else {
                boxTypeSelection.classList.add('hidden');
                boxSizeSelection.classList.add('hidden');
                document.getElementById('product-box-type').value = '';
                document.getElementById('product-box-size').value = '';
            }
        });
        
        // Show/hide box size based on box type selection
        document.getElementById('product-box-type').addEventListener('change', function() {
            const boxSizeSelection = document.getElementById('box-size-selection');
            
            if (this.value) {
                boxSizeSelection.classList.remove('hidden');
            } else {
                boxSizeSelection.classList.add('hidden');
                document.getElementById('product-box-size').value = '';
            }
        });

        // Handle add product form submission
        document.getElementById('add-product-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const isEditing = form.dataset.editCategory && form.dataset.editIndex !== undefined;
            
            const category = document.getElementById('product-category').value;
            const name = document.getElementById('product-name').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const description = document.getElementById('product-description').value;
            const stock = document.getElementById('product-stock').value;
            const customizable = document.getElementById('product-customizable').checked;
            const emoji = document.getElementById('product-emoji').value || 'üßÅ';
            const discount = parseInt(document.getElementById('product-discount').value) || 0;
            const imageFile = document.getElementById('product-image').files[0];
            const boxType = document.getElementById('product-box-type').value;
            const boxSize = parseInt(document.getElementById('product-box-size').value);
            
            // Check category limits
            let maxProducts = 7; // Default limit
            if (category === 'cuchareables') {
                maxProducts = 10; // Special limit for cuchareables
            }
            if (category === 'solo-para-mi') {
                maxProducts = 10; // Special limit for solo-para-mi (Tentaciones)
            }
            
            if (!isEditing && products[category].length >= maxProducts) {
                alert(`Esta categor√≠a ya tiene el m√°ximo de ${maxProducts} productos.`);
                return;
            }
            
            // Validate box configuration
            if (customizable && boxType && !boxSize) {
                alert('Por favor especifica el tama√±o de la caja.');
                return;
            }
            
            const product = {
                id: isEditing ? products[form.dataset.editCategory][form.dataset.editIndex].id : `product-${Date.now()}`,
                name,
                price,
                description,
                stock,
                customizable,
                emoji,
                discount,
                image: isEditing ? products[form.dataset.editCategory][form.dataset.editIndex].image : null
            };
            
            // Add box properties if it's a box product
            if (customizable && boxType && boxSize) {
                product.boxType = boxType;
                product.boxSize = boxSize;
            }
            
            // Handle image upload
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    product.image = e.target.result;
                    if (isEditing) {
                        updateProductInCategory(form.dataset.editCategory, form.dataset.editIndex, category, product);
                    } else {
                        addProductToCategory(category, product);
                    }
                };
                reader.readAsDataURL(imageFile);
            } else {
                if (isEditing) {
                    updateProductInCategory(form.dataset.editCategory, form.dataset.editIndex, category, product);
                } else {
                    addProductToCategory(category, product);
                }
            }
        });

        function addProductToCategory(category, product) {
            products[category].push(product);
            renderCategoryProducts(category);
            displayAdminProducts(category);
            closeAddProductModal();
            alert('‚úÖ Producto agregado exitosamente!');
        }

        function updateProductInCategory(oldCategory, index, newCategory, product) {
            // Remove from old category
            products[oldCategory].splice(index, 1);
            
            // Add to new category
            products[newCategory].push(product);
            
            // Re-render both categories
            renderCategoryProducts(oldCategory);
            renderCategoryProducts(newCategory);
            
            // Update admin display
            displayAdminProducts(newCategory);
            
            closeAddProductModal();
            alert('‚úÖ Producto actualizado exitosamente!');
        }

        function editProduct(category, index) {
            const product = products[category][index];
            
            // Fill form with current product data
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-category').value = category;
            document.getElementById('product-stock').value = product.stock;
            document.getElementById('product-customizable').checked = product.customizable;
            document.getElementById('product-emoji').value = product.emoji;
            document.getElementById('product-discount').value = product.discount || 0;
            
            // Handle box properties
            if (product.customizable) {
                document.getElementById('box-type-selection').classList.remove('hidden');
                if (product.boxType) {
                    document.getElementById('product-box-type').value = product.boxType;
                    document.getElementById('box-size-selection').classList.remove('hidden');
                    document.getElementById('product-box-size').value = product.boxSize || '';
                }
            }
            
            if (product.image) {
                document.getElementById('preview-img').src = product.image;
                document.getElementById('product-image-preview').classList.remove('hidden');
            }
            
            // Change form to edit mode
            document.querySelector('#add-product-modal h2').textContent = '‚úèÔ∏è Editar Producto';
            document.querySelector('#add-product-form button[type="submit"]').textContent = 'Guardar Cambios';
            
            // Store edit info
            document.getElementById('add-product-form').dataset.editCategory = category;
            document.getElementById('add-product-form').dataset.editIndex = index;
            
            showAddProductModal();
        }

        function deleteProduct(category, index) {
            const product = products[category][index];
            if (confirm(`¬øEst√°s seguro de que quieres eliminar "${product.name}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
                try {
                    // Remove product from the category
                    products[category].splice(index, 1);
                    
                    // Re-render the category products on the main page
                    renderCategoryProducts(category);
                    
                    // Re-render the admin products grid for current category
                    displayAdminProducts(currentCategory);
                    
                    // Update admin statistics
                    updateAdminStats();
                    
                    alert(`‚úÖ "${product.name}" eliminado exitosamente`);
                } catch (error) {
                    console.error('Error deleting product:', error);
                    alert('‚ùå Error al eliminar el producto. Int√©ntalo de nuevo.');
                }
            }
        }

        function toggleStoreStatus() {
            storeOpen = !storeOpen;
            const statusBanner = document.getElementById('store-status');
            const toggleBtn = document.getElementById('store-toggle-btn');
            
            if (storeOpen) {
                statusBanner.className = 'bg-green-600 text-white text-center py-2 text-sm font-medium';
                statusBanner.textContent = 'üü¢ Tienda Abierta - Recibiendo pedidos';
                toggleBtn.className = 'w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition-colors';
                toggleBtn.textContent = 'üü¢ Cerrar Tienda';
            } else {
                statusBanner.className = 'bg-red-600 text-white text-center py-2 text-sm font-medium';
                statusBanner.textContent = 'üî¥ Tienda Cerrada - No se reciben pedidos';
                toggleBtn.className = 'w-full bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg transition-colors';
                toggleBtn.textContent = 'üî¥ Abrir Tienda';
            }
        }

        function updateAdminStats() {
            const totalOrders = orders.length;
            const pendingOrders = orders.filter(order => order.status === 'pending').length;
            const completedOrders = orders.filter(order => order.status === 'completed').length;
            
            let totalRevenue = 0;
            let totalProducts = 0;
            
            orders.forEach(order => {
                const amount = parseFloat(order.total.replace('$', ''));
                totalRevenue += amount;
                totalProducts += order.items.reduce((sum, item) => sum + item.quantity, 0);
            });

            document.getElementById('pending-orders').textContent = pendingOrders;
            document.getElementById('completed-orders').textContent = completedOrders;
            document.getElementById('total-revenue').textContent = `$${totalRevenue.toFixed(2)}`;
            document.getElementById('products-sold').textContent = totalProducts;
        }

        function displayOrders() {
            const ordersList = document.getElementById('orders-list');
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p class="text-gray-500 text-center py-8">No hay pedidos registrados a√∫n</p>';
                return;
            }

            // Sort orders by timestamp (newest first)
            const sortedOrders = [...orders].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            ordersList.innerHTML = sortedOrders.map(order => {
                const statusInfo = getOrderStatusInfo(order.status);
                const paymentStatusInfo = getPaymentStatusInfo(order.paymentStatus || 'pending');
                
                return `
                <div class="bg-white border rounded-lg p-6 shadow-sm">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="font-semibold text-lg">Pedido #${order.orderNumber || order.id.slice(-6)}</h3>
                            <p class="text-gray-600">${order.date} - ${order.time}</p>
                            <div class="flex space-x-2 mt-2">
                                <span class="px-3 py-1 rounded-full text-xs ${statusInfo.bgColor} ${statusInfo.textColor}">
                                    ${statusInfo.icon} ${statusInfo.text}
                                </span>
                                <span class="px-3 py-1 rounded-full text-xs ${paymentStatusInfo.bgColor} ${paymentStatusInfo.textColor}">
                                    ${paymentStatusInfo.icon} ${paymentStatusInfo.text}
                                </span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-bold text-pink-600">${order.total}</div>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <h4 class="font-medium mb-2">üë§ Cliente:</h4>
                            <p class="text-sm text-gray-600"><strong>Nombre:</strong> ${order.customer.name}</p>
                            <p class="text-sm text-gray-600"><strong>Tel√©fono:</strong> ${order.customer.phone}</p>
                            <p class="text-sm text-gray-600"><strong>Email:</strong> ${order.customer.email}</p>
                        </div>
                        <div>
                            <h4 class="font-medium mb-2">üöö Entrega y Pago:</h4>
                            <p class="text-sm text-gray-600"><strong>M√©todo:</strong> ${order.deliveryMethod === 'pickup' ? 'üè™ Recoger en tienda' : 'üöö Delivery'}</p>
                            <p class="text-sm text-gray-600"><strong>Direcci√≥n:</strong> ${order.customer.address}</p>
                            <p class="text-sm text-gray-600"><strong>Pago:</strong> ${order.paymentMethod === 'yappy' ? 'üí≥ Yappy' : order.paymentMethod === 'transfer' ? 'üè¶ Transferencia' : 'Otro m√©todo'}</p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-medium mb-2">üì¶ Productos:</h4>
                        <div class="space-y-2 bg-gray-50 p-3 rounded-lg">
                            ${order.items.map(item => `
                                <div class="flex justify-between items-center text-sm">
                                    <span><strong>${item.name}</strong> x${item.quantity}</span>
                                    <span class="font-medium text-pink-600">$${item.price.toFixed(2)}</span>
                                </div>
                                ${item.options && item.options.length > 0 ? `<div class="text-xs text-gray-500 ml-4">‚Ä¢ Extras: ${item.options.join(', ')}</div>` : ''}
                                ${item.instructions ? `<div class="text-xs text-gray-500 ml-4">‚Ä¢ Instrucciones: ${item.instructions}</div>` : ''}
                                ${item.boxSelection && item.boxSelection.length > 0 ? `
                                    <div class="text-xs text-gray-500 ml-4">‚Ä¢ Sabores: ${item.boxSelection.map(flavor => `${flavor.emoji} ${flavor.name} x${flavor.quantity}`).join(', ')}</div>
                                ` : ''}
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap gap-2">
                        ${order.status === 'pending' ? `
                            <button onclick="verifyPayment('${order.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                üí≥ Verificar Pago
                            </button>
                            <button onclick="markOrderInProgress('${order.id}')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                üë®‚Äçüç≥ En Preparaci√≥n
                            </button>
                        ` : ''}
                        ${order.status === 'in-progress' ? `
                            <button onclick="markOrderReady('${order.id}')" class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                üì¶ Listo para Entrega
                            </button>
                        ` : ''}
                        ${order.status === 'ready' ? `
                            <button onclick="markOrderCompleted('${order.id}')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                ‚úÖ Entregar Pedido
                            </button>
                        ` : ''}
                        <button onclick="viewPaymentReceipt('${order.id}')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            üìÑ Ver Comprobante
                        </button>
                        <button onclick="notifyCustomer('${order.id}')" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            üì± Notificar Cliente
                        </button>
                        <button onclick="deleteOrder('${order.id}')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            `}).join('');
        }

        function getOrderStatusInfo(status) {
            switch(status) {
                case 'pending':
                    return { icon: '‚è≥', text: 'Pendiente', bgColor: 'bg-yellow-100', textColor: 'text-yellow-800' };
                case 'in-progress':
                    return { icon: 'üë®‚Äçüç≥', text: 'En Preparaci√≥n', bgColor: 'bg-blue-100', textColor: 'text-blue-800' };
                case 'ready':
                    return { icon: 'üì¶', text: 'Listo', bgColor: 'bg-orange-100', textColor: 'text-orange-800' };
                case 'completed':
                    return { icon: '‚úÖ', text: 'Entregado', bgColor: 'bg-green-100', textColor: 'text-green-800' };
                case 'cancelled':
                    return { icon: '‚ùå', text: 'Cancelado', bgColor: 'bg-red-100', textColor: 'text-red-800' };
                default:
                    return { icon: '‚è≥', text: 'Pendiente', bgColor: 'bg-yellow-100', textColor: 'text-yellow-800' };
            }
        }

        function getPaymentStatusInfo(paymentStatus) {
            switch(paymentStatus) {
                case 'pending':
                    return { icon: 'üí≥', text: 'Pago Pendiente', bgColor: 'bg-gray-100', textColor: 'text-gray-800' };
                case 'verified':
                    return { icon: '‚úÖ', text: 'Pago Verificado', bgColor: 'bg-green-100', textColor: 'text-green-800' };
                case 'rejected':
                    return { icon: '‚ùå', text: 'Pago Rechazado', bgColor: 'bg-red-100', textColor: 'text-red-800' };
                default:
                    return { icon: 'üí≥', text: 'Pago Pendiente', bgColor: 'bg-gray-100', textColor: 'text-gray-800' };
            }
        }

        function verifyPayment(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.paymentStatus = 'verified';
                displayOrders();
                updateAdminStats();
                updateOrdersSummary();
                alert(`‚úÖ Pago verificado para el pedido #${order.orderNumber || order.id.slice(-6)}`);
                
                // Auto-notify customer
                notifyCustomer(orderId, '‚úÖ Pago verificado. Tu pedido est√° confirmado y ser√° preparado pronto.');
            }
        }

        function markOrderInProgress(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = 'in-progress';
                displayOrders();
                updateAdminStats();
                updateOrdersSummary();
                alert(`üë®‚Äçüç≥ Pedido #${order.orderNumber || order.id.slice(-6)} marcado como "En Preparaci√≥n"`);
                
                // Auto-notify customer
                notifyCustomer(orderId, 'üë®‚Äçüç≥ ¬°Buenas noticias! Tu pedido ya est√° en preparaci√≥n.');
            }
        }

        function markOrderReady(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = 'ready';
                displayOrders();
                updateAdminStats();
                updateOrdersSummary();
                alert(`üì¶ Pedido #${order.orderNumber || order.id.slice(-6)} marcado como "Listo para Entrega"`);
                
                // Auto-notify customer
                const deliveryMsg = order.deliveryMethod === 'pickup' 
                    ? 'üì¶ Tu pedido est√° listo para recoger en la tienda.' 
                    : 'üì¶ Tu pedido est√° listo. Nos contactaremos para coordinar la entrega.';
                notifyCustomer(orderId, deliveryMsg);
            }
        }

        function notifyCustomer(orderId, customMessage = null) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                let message = customMessage;
                
                if (!message) {
                    const statusMessages = {
                        'pending': '‚è≥ Hemos recibido tu pedido y est√° siendo procesado.',
                        'in-progress': 'üë®‚Äçüç≥ Tu pedido est√° en preparaci√≥n.',
                        'ready': order.deliveryMethod === 'pickup' 
                            ? 'üì¶ Tu pedido est√° listo para recoger en la tienda.' 
                            : 'üì¶ Tu pedido est√° listo. Nos contactaremos para coordinar la entrega.',
                        'completed': '‚úÖ ¬°Gracias por tu compra! Esperamos que disfrutes nuestros productos.'
                    };
                    message = statusMessages[order.status] || 'Actualizaci√≥n de tu pedido.';
                }
                
                const fullMessage = `üè™ *Caseritos by Ela*\n\nüìã *Pedido #${order.orderNumber || order.id.slice(-6)}*\nüë§ ${order.customer.name}\n\n${message}\n\nüìû Cualquier consulta: ${contactInfo.phone}`;
                
                // Show notification options
                showNotificationModal(order, fullMessage);
            }
        }

        function showNotificationModal(order, message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-md w-full">
                    <div class="p-6">
                        <h3 class="text-lg font-semibold mb-4">üì± Enviar Notificaci√≥n</h3>
                        <div class="mb-4">
                            <p class="text-sm text-gray-600 mb-2"><strong>Cliente:</strong> ${order.customer.name}</p>
                            <p class="text-sm text-gray-600 mb-4"><strong>Tel√©fono:</strong> ${order.customer.phone}</p>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-sm font-medium mb-2">Mensaje a enviar:</p>
                                <p class="text-sm text-gray-700 whitespace-pre-line">${message}</p>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <button onclick="sendWhatsAppMessage('${order.customer.phone}', \`${message.replace(/`/g, '\\`')}\`); closeNotificationModal()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                                <span class="mr-2">üí¨</span> Enviar por WhatsApp
                            </button>
                            <button onclick="copyMessageToClipboard(\`${message.replace(/`/g, '\\`')}\`)" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                                <span class="mr-2">üìã</span> Copiar Mensaje
                            </button>
                            <button onclick="closeNotificationModal()" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-4 rounded-lg transition-colors">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function sendWhatsAppMessage(phone, message) {
            // Clean phone number (remove spaces, dashes, etc.)
            const cleanPhone = phone.replace(/\D/g, '');
            
            // Format phone for WhatsApp (add country code if not present)
            let whatsappPhone = cleanPhone;
            if (!cleanPhone.startsWith('507') && cleanPhone.length === 8) {
                whatsappPhone = '507' + cleanPhone;
            }
            
            // Encode message for URL
            const encodedMessage = encodeURIComponent(message);
            
            // Create WhatsApp URL
            const whatsappUrl = `https://wa.me/${whatsappPhone}?text=${encodedMessage}`;
            
            // Open WhatsApp
            window.open(whatsappUrl, '_blank');
            
            alert(`‚úÖ WhatsApp abierto para enviar mensaje a ${phone}\n\nSi no se abri√≥ autom√°ticamente, copia el enlace:\n${whatsappUrl}`);
        }

        function copyMessageToClipboard(message) {
            navigator.clipboard.writeText(message).then(() => {
                alert('üìã Mensaje copiado al portapapeles. Puedes pegarlo en WhatsApp, SMS o cualquier otra aplicaci√≥n.');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = message;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('üìã Mensaje copiado al portapapeles.');
            });
        }

        function closeNotificationModal() {
            const modal = document.querySelector('.fixed.inset-0.bg-black.bg-opacity-50');
            if (modal) {
                modal.remove();
            }
        }

        function viewPaymentReceipt(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) {
                alert('‚ùå Pedido no encontrado.');
                return;
            }

            const receiptContent = document.getElementById('receipt-content');
            
            if (!order.paymentReceipt) {
                receiptContent.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-6xl mb-4">üìÑ</div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">Sin Comprobante</h3>
                        <p class="text-gray-500">Este pedido no tiene comprobante de pago adjunto.</p>
                    </div>
                `;
            } else {
                const receipt = order.paymentReceipt;
                const isImage = receipt.type.startsWith('image/');
                const fileSize = (receipt.size / 1024).toFixed(1);
                
                receiptContent.innerHTML = `
                    <div class="space-y-4">
                        <!-- Order Info -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-lg mb-2">üìã Informaci√≥n del Pedido</h3>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div><strong>Pedido:</strong> #${order.orderNumber || order.id.slice(-6)}</div>
                                <div><strong>Cliente:</strong> ${order.customer.name}</div>
                                <div><strong>Total:</strong> ${order.total}</div>
                                <div><strong>M√©todo de Pago:</strong> ${order.paymentMethod === 'yappy' ? 'üí≥ Yappy' : 'üè¶ Transferencia'}</div>
                            </div>
                        </div>

                        <!-- Receipt File Info -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-lg mb-2">üìé Informaci√≥n del Archivo</h3>
                            <div class="text-sm space-y-1">
                                <div><strong>Nombre:</strong> ${receipt.name}</div>
                                <div><strong>Tipo:</strong> ${receipt.type}</div>
                                <div><strong>Tama√±o:</strong> ${fileSize} KB</div>
                            </div>
                        </div>

                        <!-- Receipt Preview -->
                        <div class="border rounded-lg p-4">
                            <h3 class="font-semibold text-lg mb-4">üëÅÔ∏è Vista Previa del Comprobante</h3>
                            ${isImage ? `
                                <div class="text-center">
                                    <img src="${receipt.data}" alt="Comprobante de Pago" class="max-w-full h-auto rounded-lg shadow-lg border">
                                </div>
                            ` : `
                                <div class="text-center py-8">
                                    <div class="text-4xl mb-2">üìÑ</div>
                                    <p class="text-gray-600">Archivo no es una imagen</p>
                                    <p class="text-sm text-gray-500">Tipo: ${receipt.type}</p>
                                </div>
                            `}
                        </div>

                        <!-- Actions -->
                        <div class="flex space-x-3">
                            <button onclick="downloadPaymentReceipt('${orderId}')" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                                <span class="mr-2">üíæ</span> Descargar Comprobante
                            </button>
                            ${order.paymentStatus === 'pending' ? `
                                <button onclick="verifyPaymentFromReceipt('${orderId}')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                                    <span class="mr-2">‚úÖ</span> Verificar Pago
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            document.getElementById('payment-receipt-modal').classList.remove('hidden');
        }

        function closePaymentReceiptModal() {
            document.getElementById('payment-receipt-modal').classList.add('hidden');
        }

        function downloadPaymentReceipt(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order || !order.paymentReceipt) {
                alert('‚ùå No hay comprobante para descargar.');
                return;
            }

            const receipt = order.paymentReceipt;
            
            try {
                // Create download link
                const link = document.createElement('a');
                link.href = receipt.data;
                
                // Generate filename with order info
                const orderNumber = order.orderNumber || order.id.slice(-6);
                const customerName = order.customer.name.replace(/[^a-zA-Z0-9]/g, '_');
                const fileExtension = receipt.name.split('.').pop() || 'jpg';
                const fileName = `Comprobante_${orderNumber}_${customerName}.${fileExtension}`;
                
                link.download = fileName;
                link.style.display = 'none';
                
                // Add to DOM, click, and remove
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Show success message with file info
                alert(`üíæ Comprobante descargado exitosamente!\n\nüìÑ Archivo: ${fileName}\nüë§ Cliente: ${order.customer.name}\nüìã Pedido: #${orderNumber}\nüí∞ Total: ${order.total}`);
                
            } catch (error) {
                console.error('Error downloading receipt:', error);
                
                // Fallback: Open in new tab if download fails
                try {
                    const newWindow = window.open(receipt.data, '_blank');
                    if (newWindow) {
                        alert('üíæ El comprobante se ha abierto en una nueva pesta√±a.\n\nPuedes hacer clic derecho en la imagen y seleccionar "Guardar imagen como..." para descargarla.');
                    } else {
                        alert('‚ùå No se pudo descargar el comprobante. Por favor verifica que tu navegador permita descargas.');
                    }
                } catch (fallbackError) {
                    alert('‚ùå Error al acceder al comprobante. El archivo puede estar corrupto.');
                }
            }
        }

        function verifyPaymentFromReceipt(orderId) {
            if (confirm('¬øConfirmas que el comprobante de pago es v√°lido y el pago ha sido recibido?')) {
                verifyPayment(orderId);
                closePaymentReceiptModal();
            }
        }

        function markOrderCompleted(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = 'completed';
                displayOrders();
                updateAdminStats();
                updateOrdersSummary();
                alert(`‚úÖ Pedido #${order.orderNumber || order.id.slice(-6)} marcado como "Entregado"`);
                
                // Auto-notify customer
                notifyCustomer(orderId, '‚úÖ ¬°Tu pedido ha sido entregado! Gracias por elegirnos. Esperamos que disfrutes nuestros productos.');
            }
        }

        function deleteOrder(orderId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este pedido?\n\nEsta acci√≥n no se puede deshacer.')) {
                orders = orders.filter(o => o.id !== orderId);
                displayOrders();
                updateAdminStats();
                updateOrdersSummary();
                alert('üóëÔ∏è Pedido eliminado exitosamente');
            }
        }

        function filterOrders() {
            const statusFilter = document.getElementById('order-status-filter').value;
            const paymentFilter = document.getElementById('payment-status-filter').value;
            const searchTerm = document.getElementById('customer-search').value.toLowerCase();
            
            let filteredOrders = [...orders];
            
            // Filter by status
            if (statusFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }
            
            // Filter by payment status
            if (paymentFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => (order.paymentStatus || 'pending') === paymentFilter);
            }
            
            // Filter by search term
            if (searchTerm) {
                filteredOrders = filteredOrders.filter(order => 
                    order.customer.name.toLowerCase().includes(searchTerm) ||
                    order.customer.phone.includes(searchTerm) ||
                    order.customer.email.toLowerCase().includes(searchTerm) ||
                    (order.orderNumber || order.id.slice(-6)).toLowerCase().includes(searchTerm)
                );
            }
            
            displayFilteredOrders(filteredOrders);
        }

        function displayFilteredOrders(filteredOrders) {
            const ordersList = document.getElementById('orders-list');
            
            if (filteredOrders.length === 0) {
                ordersList.innerHTML = '<p class="text-gray-500 text-center py-8">No se encontraron pedidos con los filtros aplicados</p>';
                return;
            }

            // Sort orders by timestamp (newest first)
            const sortedOrders = [...filteredOrders].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            ordersList.innerHTML = sortedOrders.map(order => {
                const statusInfo = getOrderStatusInfo(order.status);
                const paymentStatusInfo = getPaymentStatusInfo(order.paymentStatus || 'pending');
                
                return `
                <div class="bg-white border rounded-lg p-6 shadow-sm">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="font-semibold text-lg">Pedido #${order.orderNumber || order.id.slice(-6)}</h3>
                            <p class="text-gray-600">${order.date} - ${order.time}</p>
                            <div class="flex space-x-2 mt-2">
                                <span class="px-3 py-1 rounded-full text-xs ${statusInfo.bgColor} ${statusInfo.textColor}">
                                    ${statusInfo.icon} ${statusInfo.text}
                                </span>
                                <span class="px-3 py-1 rounded-full text-xs ${paymentStatusInfo.bgColor} ${paymentStatusInfo.textColor}">
                                    ${paymentStatusInfo.icon} ${paymentStatusInfo.text}
                                </span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-bold text-pink-600">${order.total}</div>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <h4 class="font-medium mb-2">üë§ Cliente:</h4>
                            <p class="text-sm text-gray-600"><strong>Nombre:</strong> ${order.customer.name}</p>
                            <p class="text-sm text-gray-600"><strong>Tel√©fono:</strong> ${order.customer.phone}</p>
                            <p class="text-sm text-gray-600"><strong>Email:</strong> ${order.customer.email}</p>
                        </div>
                        <div>
                            <h4 class="font-medium mb-2">üöö Entrega y Pago:</h4>
                            <p class="text-sm text-gray-600"><strong>M√©todo:</strong> ${order.deliveryMethod === 'pickup' ? 'üè™ Recoger en tienda' : 'üöö Delivery'}</p>
                            <p class="text-sm text-gray-600"><strong>Direcci√≥n:</strong> ${order.customer.address}</p>
                            <p class="text-sm text-gray-600"><strong>Pago:</strong> ${order.paymentMethod === 'yappy' ? 'üí≥ Yappy' : order.paymentMethod === 'transfer' ? 'üè¶ Transferencia' : 'Otro m√©todo'}</p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-medium mb-2">üì¶ Productos:</h4>
                        <div class="space-y-2 bg-gray-50 p-3 rounded-lg">
                            ${order.items.map(item => `
                                <div class="flex justify-between items-center text-sm">
                                    <span><strong>${item.name}</strong> x${item.quantity}</span>
                                    <span class="font-medium text-pink-600">$${item.price.toFixed(2)}</span>
                                </div>
                                ${item.options && item.options.length > 0 ? `<div class="text-xs text-gray-500 ml-4">‚Ä¢ Extras: ${item.options.join(', ')}</div>` : ''}
                                ${item.instructions ? `<div class="text-xs text-gray-500 ml-4">‚Ä¢ Instrucciones: ${item.instructions}</div>` : ''}
                                ${item.boxSelection && item.boxSelection.length > 0 ? `
                                    <div class="text-xs text-gray-500 ml-4">‚Ä¢ Sabores: ${item.boxSelection.map(flavor => `${flavor.emoji} ${flavor.name} x${flavor.quantity}`).join(', ')}</div>
                                ` : ''}
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap gap-2">
                        ${order.status === 'pending' ? `
                            <button onclick="verifyPayment('${order.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                üí≥ Verificar Pago
                            </button>
                            <button onclick="markOrderInProgress('${order.id}')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                üë®‚Äçüç≥ En Preparaci√≥n
                            </button>
                        ` : ''}
                        ${order.status === 'in-progress' ? `
                            <button onclick="markOrderReady('${order.id}')" class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                üì¶ Listo para Entrega
                            </button>
                        ` : ''}
                        ${order.status === 'ready' ? `
                            <button onclick="markOrderCompleted('${order.id}')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                ‚úÖ Entregar Pedido
                            </button>
                        ` : ''}
                        <button onclick="viewPaymentReceipt('${order.id}')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            üìÑ Ver Comprobante
                        </button>
                        <button onclick="notifyCustomer('${order.id}')" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            üì± Notificar Cliente
                        </button>
                        <button onclick="deleteOrder('${order.id}')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            `}).join('');
        }

        function clearOrderFilters() {
            document.getElementById('order-status-filter').value = 'all';
            document.getElementById('payment-status-filter').value = 'all';
            document.getElementById('customer-search').value = '';
            displayOrders();
        }

        function updateOrdersSummary() {
            const pendingCount = orders.filter(o => o.status === 'pending').length;
            const progressCount = orders.filter(o => o.status === 'in-progress').length;
            const readyCount = orders.filter(o => o.status === 'ready').length;
            const completedCount = orders.filter(o => o.status === 'completed').length;
            const totalCount = orders.length;

            document.getElementById('pending-count').textContent = pendingCount;
            document.getElementById('progress-count').textContent = progressCount;
            document.getElementById('ready-count').textContent = readyCount;
            document.getElementById('completed-count').textContent = completedCount;
            document.getElementById('total-orders-count').textContent = totalCount;
        }

        // Categories management functions
        function loadCategoriesEditor() {
            const categoriesList = document.getElementById('categories-list');
            categoriesList.innerHTML = '';
            
            Object.keys(categories).forEach(categoryKey => {
                const category = categories[categoryKey];
                const categoryCard = document.createElement('div');
                categoryCard.className = 'bg-white border rounded-lg p-6';
                
                categoryCard.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nombre de la Categor√≠a</label>
                            <input type="text" id="cat-name-${categoryKey}" value="${category.name}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
                            <textarea id="cat-desc-${categoryKey}" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">${category.description}</textarea>
                        </div>
                        <div class="text-sm text-gray-500">
                            ID de categor√≠a: ${categoryKey}
                        </div>
                    </div>
                `;
                
                categoriesList.appendChild(categoryCard);
            });
        }
        
        function saveCategoryChanges() {
            Object.keys(categories).forEach(categoryKey => {
                const nameInput = document.getElementById(`cat-name-${categoryKey}`);
                const descInput = document.getElementById(`cat-desc-${categoryKey}`);
                
                if (nameInput && descInput) {
                    categories[categoryKey].name = nameInput.value;
                    categories[categoryKey].description = descInput.value;
                }
            });
            
            // Update all category displays
            updateCategoryTitlesAndDescriptions();
            updateCategoryNavigation();
            
            alert('üíæ ¬°Cambios en categor√≠as guardados exitosamente!');
        }
        
        function updateCategoryTitlesAndDescriptions() {
            Object.keys(categories).forEach(categoryKey => {
                const category = categories[categoryKey];
                
                // Update section titles
                const titleElement = document.getElementById(`${categoryKey}-title`);
                if (titleElement) {
                    titleElement.textContent = category.name;
                }
                
                // Update section descriptions
                const descElement = document.getElementById(`${categoryKey}-description`);
                if (descElement) {
                    descElement.textContent = category.description;
                }
            });
        }

        // Store customization functions
        function loadStoreSettings() {
            document.getElementById('store-name-input').value = storeSettings.name;
            document.getElementById('store-logo-input').value = storeSettings.logo;
            document.getElementById('store-description-input').value = storeSettings.description;
            document.getElementById('primary-color-input').value = storeSettings.primaryColor;
            document.getElementById('primary-color-text').value = storeSettings.primaryColor;
            document.getElementById('secondary-color-input').value = storeSettings.secondaryColor;
            document.getElementById('secondary-color-text').value = storeSettings.secondaryColor;
            updateColorPreview();
        }
        
        function updateColorPreview() {
            const primary = document.getElementById('primary-color-input').value;
            const secondary = document.getElementById('secondary-color-input').value;
            document.getElementById('color-preview').style.background = `linear-gradient(135deg, ${primary} 0%, ${secondary} 100%)`;
        }
        
        function applyColors() {
            const primary = document.getElementById('primary-color-input').value;
            const secondary = document.getElementById('secondary-color-input').value;
            
            storeSettings.primaryColor = primary;
            storeSettings.secondaryColor = secondary;
            
            // Update gradient background
            document.querySelector('.gradient-bg').style.background = `linear-gradient(135deg, ${primary} 0%, ${secondary} 100%)`;
            
            // Update cart button
            document.getElementById('cart-btn-desktop').style.backgroundColor = primary;
            
            // Update store name colors
            document.getElementById('store-name-nav').style.color = primary;
            
            // Update all primary color elements
            const style = document.createElement('style');
            style.textContent = `
                .text-pink-600 { color: ${primary} !important; }
                .bg-pink-600 { background-color: ${primary} !important; }
                .hover\\:bg-pink-700:hover { background-color: ${adjustBrightness(primary, -20)} !important; }
                .border-pink-500 { border-color: ${primary} !important; }
                .focus\\:ring-pink-500:focus { --tw-ring-color: ${primary}40 !important; }
            `;
            document.head.appendChild(style);
            
            updateColorPreview();
            alert('üé® Colores aplicados exitosamente!');
        }
        
        function adjustBrightness(hex, percent) {
            const num = parseInt(hex.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }
        
        function updateStoreBranding() {
            const name = storeSettings.name;
            const logo = storeSettings.logo;
            const description = storeSettings.description;
            
            // Update all store name elements
            document.getElementById('store-name-nav').textContent = `${logo} ${name}`;
            document.getElementById('store-name-hero').textContent = `${logo} ${name}`;
            document.getElementById('store-name-footer').textContent = `${logo} ${name}`;
            
            // Update descriptions
            document.getElementById('store-description-hero').textContent = description + '. Perfecta para cumplea√±os, celebraciones y momentos especiales.';
            document.getElementById('store-description-footer').textContent = description + ' para endulzar tus momentos especiales.';
        }
        
        // Handle store settings form
        document.getElementById('store-settings-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            storeSettings.name = document.getElementById('store-name-input').value;
            storeSettings.logo = document.getElementById('store-logo-input').value;
            storeSettings.description = document.getElementById('store-description-input').value;
            
            updateStoreBranding();
            alert('üíæ Informaci√≥n de la tienda guardada exitosamente!');
        });
        
        // Handle security form
        document.getElementById('security-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newPassword = document.getElementById('new-admin-password').value;
            const confirmPassword = document.getElementById('confirm-admin-password').value;
            
            if (!newPassword) {
                alert('‚ö†Ô∏è Por favor ingresa una nueva contrase√±a.');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('‚ùå Las contrase√±as no coinciden.');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('‚ö†Ô∏è La contrase√±a debe tener al menos 6 caracteres.');
                return;
            }
            
            adminPassword = newPassword;
            document.getElementById('new-admin-password').value = '';
            document.getElementById('confirm-admin-password').value = '';
            alert('üîí Contrase√±a cambiada exitosamente!');
        });
        
        // Handle color input synchronization
        document.getElementById('primary-color-input').addEventListener('input', function() {
            document.getElementById('primary-color-text').value = this.value;
            updateColorPreview();
        });
        
        document.getElementById('primary-color-text').addEventListener('input', function() {
            if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                document.getElementById('primary-color-input').value = this.value;
                updateColorPreview();
            }
        });
        
        document.getElementById('secondary-color-input').addEventListener('input', function() {
            document.getElementById('secondary-color-text').value = this.value;
            updateColorPreview();
        });
        
        document.getElementById('secondary-color-text').addEventListener('input', function() {
            if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                document.getElementById('secondary-color-input').value = this.value;
                updateColorPreview();
            }
        });
        
        // Handle admin button visibility toggle
        document.getElementById('show-admin-btn').addEventListener('change', function() {
            const showButton = this.checked;
            const desktopBtn = document.getElementById('admin-btn-desktop');
            const mobileBtn = document.getElementById('admin-btn-mobile');
            
            if (showButton) {
                desktopBtn.classList.remove('hidden');
                mobileBtn.classList.remove('hidden');
            } else {
                desktopBtn.classList.add('hidden');
                mobileBtn.classList.add('hidden');
            }
        });
        
        // Set admin button visible by default
        document.getElementById('show-admin-btn').checked = true;

        // Products dropdown menu functions
        function toggleProductsMenu() {
            const dropdown = document.getElementById('products-dropdown');
            dropdown.classList.toggle('hidden');
            updateProductsDropdown();
        }
        
        function toggleProductsMenuHero() {
            const dropdown = document.getElementById('products-dropdown-hero');
            dropdown.classList.toggle('hidden');
            updateProductsDropdownHero();
        }
        
        function updateProductsDropdown() {
            const menu = document.getElementById('products-dropdown-menu');
            menu.innerHTML = '';
            
            Object.keys(categories).forEach(categoryKey => {
                const category = categories[categoryKey];
                const link = document.createElement('a');
                link.href = `#${categoryKey}`;
                link.className = 'block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors';
                link.textContent = category.name;
                link.onclick = function(e) {
                    e.preventDefault();
                    scrollToSection(categoryKey);
                    closeProductsMenu();
                };
                menu.appendChild(link);
            });
        }
        
        function updateProductsDropdownHero() {
            const menu = document.getElementById('products-dropdown-menu-hero');
            menu.innerHTML = '';
            
            Object.keys(categories).forEach(categoryKey => {
                const category = categories[categoryKey];
                const link = document.createElement('a');
                link.href = `#${categoryKey}`;
                link.className = 'block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors';
                link.textContent = category.name;
                link.onclick = function(e) {
                    e.preventDefault();
                    scrollToSection(categoryKey);
                    closeProductsMenuHero();
                };
                menu.appendChild(link);
            });
        }
        
        function closeProductsMenu() {
            document.getElementById('products-dropdown').classList.add('hidden');
        }
        
        function closeProductsMenuHero() {
            document.getElementById('products-dropdown-hero').classList.add('hidden');
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('products-dropdown');
            const dropdownHero = document.getElementById('products-dropdown-hero');
            const button = event.target.closest('button');
            
            if (!button || (button.onclick !== toggleProductsMenu && button.onclick !== toggleProductsMenuHero)) {
                dropdown.classList.add('hidden');
                dropdownHero.classList.add('hidden');
            }
        });

        // Brand logo functions
        function handleBrandLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) { // 2MB limit
                    alert('La imagen es muy grande. Por favor selecciona una imagen menor a 2MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    storeSettings.brandImage = e.target.result;
                    document.getElementById('brand-preview-img').src = e.target.result;
                    document.getElementById('brand-logo-preview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }
        
        function removeBrandLogo() {
            storeSettings.brandImage = null;
            document.getElementById('brand-logo-preview').classList.add('hidden');
            document.getElementById('brand-logo').value = '';
        }

        // Hero banner functions
        function handleHeroBannerUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    alert('La imagen es muy grande. Por favor selecciona una imagen menor a 5MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    storeSettings.heroBanner = e.target.result;
                    document.getElementById('banner-preview-img').src = e.target.result;
                    document.getElementById('hero-banner-preview').classList.remove('hidden');
                    updateBannerHeight();
                };
                reader.readAsDataURL(file);
            }
        }
        
        function removeHeroBanner() {
            storeSettings.heroBanner = null;
            document.getElementById('hero-banner-preview').classList.add('hidden');
            document.getElementById('hero-banner').value = '';
            updateHeroSection();
        }

        function updateBannerHeight() {
            const height = document.getElementById('banner-height-slider').value;
            storeSettings.bannerHeight = parseInt(height);
            document.getElementById('banner-height-display').textContent = height + 'px';
            updateHeroSection();
        }

        function updateHeroSection() {
            const heroSection = document.querySelector('#inicio');
            if (storeSettings.heroBanner) {
                heroSection.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url(${storeSettings.heroBanner})`;
                heroSection.style.backgroundSize = 'cover';
                heroSection.style.backgroundPosition = 'center';
                heroSection.style.backgroundRepeat = 'no-repeat';
                heroSection.style.minHeight = storeSettings.bannerHeight + 'px';
                heroSection.classList.remove('gradient-bg');
            } else {
                heroSection.style.backgroundImage = '';
                heroSection.style.backgroundSize = '';
                heroSection.style.backgroundPosition = '';
                heroSection.style.backgroundRepeat = '';
                heroSection.style.minHeight = '';
                heroSection.classList.add('gradient-bg');
                heroSection.style.background = `linear-gradient(135deg, ${storeSettings.primaryColor} 0%, ${storeSettings.secondaryColor} 100%)`;
            }
        }

        // Typography functions
        function applyFont() {
            const primaryFont = document.getElementById('font-family-select').value;
            const secondaryFont = document.getElementById('secondary-font-select').value;
            
            storeSettings.fontFamily = primaryFont;
            storeSettings.secondaryFontFamily = secondaryFont;
            
            // Apply primary font to headings and navigation
            const primaryElements = 'h1, h2, h3, h4, h5, h6, nav, .font-bold, .font-semibold';
            const style = document.createElement('style');
            style.textContent = `
                ${primaryElements} { font-family: '${primaryFont}', sans-serif !important; }
                body, p, span, div:not(${primaryElements}), .text-base { font-family: '${secondaryFont}', sans-serif !important; }
            `;
            
            // Remove previous typography styles
            const existingStyle = document.getElementById('typography-styles');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            style.id = 'typography-styles';
            document.head.appendChild(style);
            
            alert('üî§ Tipograf√≠a aplicada exitosamente!');
        }
        
        // Font preview updates
        document.getElementById('font-family-select').addEventListener('change', function() {
            const selectedFont = this.value;
            document.getElementById('primary-font-preview').style.fontFamily = `'${selectedFont}', sans-serif`;
        });
        
        document.getElementById('secondary-font-select').addEventListener('change', function() {
            const selectedFont = this.value;
            document.getElementById('secondary-font-preview').style.fontFamily = `'${selectedFont}', sans-serif`;
        });

        // Contact form handler
        document.getElementById('contact-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            contactInfo.address = document.getElementById('contact-address').value;
            contactInfo.phone = document.getElementById('contact-phone').value;
            contactInfo.email = document.getElementById('contact-email').value;
            contactInfo.hours = document.getElementById('contact-hours').value;
            
            updateContactInfo();
            alert('üìû Informaci√≥n de contacto guardada exitosamente!');
        });
        
        function updateContactInfo() {
            // Update contact section
            const contactSection = document.querySelector('#contacto .grid');
            if (contactSection) {
                contactSection.innerHTML = `
                    <div class="space-y-8">
                        <div class="flex items-start">
                            <div class="w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center mr-4">
                                <span class="text-2xl">üìç</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900 mb-2">Direcci√≥n</h3>
                                <p class="text-gray-600">${contactInfo.address}</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                                <span class="text-2xl">üì±</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900 mb-2">Tel√©fono</h3>
                                <p class="text-gray-600">${contactInfo.phone}</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                                <span class="text-2xl">üìß</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900 mb-2">Email</h3>
                                <p class="text-gray-600">${contactInfo.email}</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-8 rounded-xl">
                        <h3 class="text-xl font-semibold mb-6">Env√≠anos un mensaje</h3>
                        <form class="space-y-4">
                            <input type="text" placeholder="Tu nombre" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                            <input type="email" placeholder="Tu email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                            <textarea rows="4" placeholder="Tu mensaje..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"></textarea>
                            <button type="button" onclick="alert('¬°Mensaje enviado! Te contactaremos pronto.')" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                                Enviar Mensaje
                            </button>
                        </form>
                    </div>
                `;
            }
            
            // Update footer hours
            const footerHours = document.querySelector('footer ul');
            if (footerHours) {
                footerHours.innerHTML = contactInfo.hours.split('\n').map(line => 
                    `<li class="text-gray-400">${line}</li>`
                ).join('');
            }
        }
        
        function loadStoreSettings() {
            document.getElementById('store-name-input').value = storeSettings.name;
            document.getElementById('store-logo-input').value = storeSettings.logo;
            document.getElementById('store-description-input').value = storeSettings.description;
            document.getElementById('primary-color-input').value = storeSettings.primaryColor;
            document.getElementById('primary-color-text').value = storeSettings.primaryColor;
            document.getElementById('secondary-color-input').value = storeSettings.secondaryColor;
            document.getElementById('secondary-color-text').value = storeSettings.secondaryColor;
            document.getElementById('font-family-select').value = storeSettings.fontFamily;
            document.getElementById('secondary-font-select').value = storeSettings.secondaryFontFamily;
            
            // Load contact info
            document.getElementById('contact-address').value = contactInfo.address;
            document.getElementById('contact-phone').value = contactInfo.phone;
            document.getElementById('contact-email').value = contactInfo.email;
            document.getElementById('contact-hours').value = contactInfo.hours;
            document.getElementById('yappy-number-input').value = contactInfo.yappyNumber;
            document.getElementById('bank-account-input').value = contactInfo.bankAccount;
            
            // Load brand image if exists
            if (storeSettings.brandImage) {
                document.getElementById('brand-preview-img').src = storeSettings.brandImage;
                document.getElementById('brand-logo-preview').classList.remove('hidden');
            }
            
            // Load hero banner if exists
            if (storeSettings.heroBanner) {
                document.getElementById('banner-preview-img').src = storeSettings.heroBanner;
                document.getElementById('hero-banner-preview').classList.remove('hidden');
                document.getElementById('banner-height-slider').value = storeSettings.bannerHeight;
                document.getElementById('banner-height-display').textContent = storeSettings.bannerHeight + 'px';
            }
            
            // Update font previews
            document.getElementById('primary-font-preview').style.fontFamily = `'${storeSettings.fontFamily}', sans-serif`;
            document.getElementById('secondary-font-preview').style.fontFamily = `'${storeSettings.secondaryFontFamily}', sans-serif`;
            
            updateColorPreview();
        }
        
        function updateStoreBranding() {
            const name = storeSettings.name;
            const description = storeSettings.description;
            
            // Update navigation
            document.getElementById('store-name-nav').textContent = name;
            if (storeSettings.brandImage) {
                document.getElementById('nav-logo-image').src = storeSettings.brandImage;
                document.getElementById('nav-logo-image').classList.remove('hidden');
                document.getElementById('nav-logo-emoji').classList.add('hidden');
            } else {
                document.getElementById('nav-logo-emoji').textContent = storeSettings.logo;
                document.getElementById('nav-logo-emoji').classList.remove('hidden');
                document.getElementById('nav-logo-image').classList.add('hidden');
            }
            
            // Update hero section
            document.getElementById('store-name-hero').textContent = name;
            if (storeSettings.brandImage) {
                document.getElementById('hero-logo-image').src = storeSettings.brandImage;
                document.getElementById('hero-logo-image').classList.remove('hidden');
                document.getElementById('hero-logo-emoji').classList.add('hidden');
            } else {
                document.getElementById('hero-logo-emoji').textContent = storeSettings.logo;
                document.getElementById('hero-logo-emoji').classList.remove('hidden');
                document.getElementById('hero-logo-image').classList.add('hidden');
            }
            
            // Update footer
            document.getElementById('store-name-footer').textContent = name;
            if (storeSettings.brandImage) {
                document.getElementById('footer-logo-image').src = storeSettings.brandImage;
                document.getElementById('footer-logo-image').classList.remove('hidden');
                document.getElementById('footer-logo-emoji').classList.add('hidden');
            } else {
                document.getElementById('footer-logo-emoji').textContent = storeSettings.logo;
                document.getElementById('footer-logo-emoji').classList.remove('hidden');
                document.getElementById('footer-logo-image').classList.add('hidden');
            }
            
            // Update descriptions
            document.getElementById('store-description-hero').textContent = description + '. Perfecta para cumplea√±os, celebraciones y momentos especiales.';
            document.getElementById('store-description-footer').textContent = description + ' para endulzar tus momentos especiales.';
        }

        // Delivery management functions
        function updateDeliverySchedule() {
            const nextDate = document.getElementById('admin-next-delivery').value;
            const interval = parseInt(document.getElementById('delivery-interval').value);
            
            if (!nextDate) {
                alert('Por favor selecciona una fecha de entrega.');
                return;
            }
            
            deliverySettings.nextDeliveryDate = nextDate;
            deliverySettings.intervalDays = interval;
            
            updateNextDeliveryDisplay();
            alert('üìÖ Fechas de entrega actualizadas exitosamente!');
        }
        
        function updateNextDeliveryDisplay() {
            if (deliverySettings.nextDeliveryDate) {
                const date = new Date(deliverySettings.nextDeliveryDate);
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                const formattedDate = date.toLocaleDateString('es-ES', options);
                document.getElementById('next-delivery-date').textContent = formattedDate;
                document.getElementById('delivery-date').value = deliverySettings.nextDeliveryDate;
            } else {
                // Set default to 15 days from now
                const nextDate = new Date();
                nextDate.setDate(nextDate.getDate() + 15);
                const dateString = nextDate.toISOString().split('T')[0];
                deliverySettings.nextDeliveryDate = dateString;
                document.getElementById('admin-next-delivery').value = dateString;
                updateNextDeliveryDisplay();
            }
        }

        // Extras management functions
        function loadExtrasEditor() {
            loadToppingsEditor();
            loadGiftOptionsEditor();
            loadAdditionalOptionsEditor();
            
            // Load current delivery settings
            if (deliverySettings.nextDeliveryDate) {
                document.getElementById('admin-next-delivery').value = deliverySettings.nextDeliveryDate;
            }
            document.getElementById('delivery-interval').value = deliverySettings.intervalDays;
        }

        function loadToppingsEditor() {
            loadAdminToppingsSection('creamy', 'admin-creamy-toppings');
            loadAdminToppingsSection('regular', 'admin-regular-toppings');
        }

        function loadAdminToppingsSection(type, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            
            brownieToppings[type].forEach((topping, index) => {
                const toppingDiv = document.createElement('div');
                toppingDiv.className = 'flex items-center justify-between p-3 bg-white rounded-lg border';
                
                toppingDiv.innerHTML = `
                    <div class="flex items-center space-x-3 flex-1">
                        <input type="text" 
                               value="${topping.emoji}" 
                               class="w-12 text-center text-xl border border-gray-300 rounded px-1 py-1" 
                               onchange="updateToppingEmoji('${type}', ${index}, this.value)"
                               maxlength="2">
                        <div class="flex-1">
                            <input type="text" 
                                   value="${topping.name}" 
                                   class="w-full font-medium border border-gray-300 rounded px-2 py-1 mb-1" 
                                   onchange="updateToppingName('${type}', ${index}, this.value)"
                                   placeholder="Nombre del topping">
                            <p class="text-sm ${topping.available ? 'text-green-600' : 'text-red-500'}">
                                ${topping.available ? '‚úÖ Disponible' : '‚ùå No disponible'}
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   id="admin-topping-${type}-${index}" 
                                   class="sr-only peer" 
                                   ${topping.available ? 'checked' : ''} 
                                   onchange="toggleToppingAvailability('${type}', ${index})">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-amber-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-amber-600"></div>
                        </label>
                        <button onclick="removeToppingFromList('${type}', ${index})" 
                                class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                `;
                container.appendChild(toppingDiv);
            });
            
            // Add "Add New Topping" button
            const addButton = document.createElement('div');
            addButton.className = 'flex items-center justify-center p-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 hover:border-amber-400 cursor-pointer transition-colors mt-3';
            addButton.innerHTML = `
                <button onclick="addNewTopping('${type}')" 
                        class="text-amber-600 hover:text-amber-700 font-medium text-sm">
                    ‚ûï Agregar ${type === 'creamy' ? 'Creamy' : 'Regular'} Topping
                </button>
            `;
            container.appendChild(addButton);
        }

        function toggleToppingAvailability(type, index) {
            if (brownieToppings[type] && brownieToppings[type][index]) {
                brownieToppings[type][index].available = !brownieToppings[type][index].available;
                
                // Update the status text immediately
                const statusText = document.querySelector(`#admin-topping-${type}-${index}`).closest('.flex').querySelector('p');
                if (statusText) {
                    const isAvailable = brownieToppings[type][index].available;
                    statusText.className = `text-sm ${isAvailable ? 'text-green-600' : 'text-red-500'}`;
                    statusText.textContent = isAvailable ? '‚úÖ Disponible' : '‚ùå No disponible';
                }
            }
        }

        function updateToppingName(type, index, newName) {
            if (brownieToppings[type] && brownieToppings[type][index]) {
                brownieToppings[type][index].name = newName.trim();
            }
        }

        function updateToppingEmoji(type, index, newEmoji) {
            if (brownieToppings[type] && brownieToppings[type][index]) {
                brownieToppings[type][index].emoji = newEmoji;
            }
        }

        function addNewTopping(type) {
            const newTopping = {
                id: `${type}-topping-${Date.now()}`,
                name: `Nuevo ${type === 'creamy' ? 'Creamy' : 'Regular'} Topping`,
                emoji: type === 'creamy' ? 'üçØ' : 'üç´',
                available: true
            };
            
            brownieToppings[type].push(newTopping);
            loadAdminToppingsSection(type, type === 'creamy' ? 'admin-creamy-toppings' : 'admin-regular-toppings');
            
            alert(`‚úÖ Nuevo ${type === 'creamy' ? 'Creamy' : 'Regular'} Topping agregado!\n\nPuedes editar el nombre y emoji directamente en la lista.`);
        }

        function removeToppingFromList(type, index) {
            if (!brownieToppings[type] || !brownieToppings[type][index]) return;
            
            const topping = brownieToppings[type][index];
            if (confirm(`¬øEst√°s seguro de que quieres eliminar "${topping.name}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
                brownieToppings[type].splice(index, 1);
                loadAdminToppingsSection(type, type === 'creamy' ? 'admin-creamy-toppings' : 'admin-regular-toppings');
                alert(`üóëÔ∏è "${topping.name}" eliminado exitosamente.`);
            }
        }

        function saveToppingsAvailability() {
            // Validate that we have at least some toppings available
            const availableCreamy = brownieToppings.creamy.filter(t => t.available).length;
            const availableRegular = brownieToppings.regular.filter(t => t.available).length;
            
            if (availableCreamy === 0 || availableRegular === 0) {
                alert('‚ö†Ô∏è Advertencia: Debes tener al menos un topping disponible de cada tipo (Creamy y Regular) para que las cajas de brownies funcionen correctamente.');
                return;
            }
            
            alert(`üíæ ¬°Disponibilidad de toppings guardada exitosamente!\n\n‚úÖ ${availableCreamy} Creamy Toppings disponibles\n‚úÖ ${availableRegular} Regular Toppings disponibles\n\nLos cambios se aplicar√°n inmediatamente en las cajas de brownies.`);
        }
        
        function loadGiftOptionsEditor() {
            const container = document.getElementById('gift-options-editor');
            container.innerHTML = '';
            
            giftOptions.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'flex items-center space-x-4 p-3 bg-white rounded-lg border';
                optionDiv.innerHTML = `
                    <input type="text" value="${option.name}" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg" onchange="updateGiftOption(${index}, 'name', this.value)">
                    <div class="flex items-center space-x-2">
                        <span>$</span>
                        <input type="number" value="${option.price}" step="0.01" min="0" class="w-20 px-3 py-2 border border-gray-300 rounded-lg" onchange="updateGiftOption(${index}, 'price', parseFloat(this.value))">
                    </div>
                    <button onclick="removeGiftOption(${index})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg transition-colors">
                        üóëÔ∏è
                    </button>
                `;
                container.appendChild(optionDiv);
            });
        }
        
        function loadAdditionalOptionsEditor() {
            const container = document.getElementById('additional-options-editor');
            container.innerHTML = '';
            
            additionalOptions.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'flex items-center space-x-4 p-3 bg-white rounded-lg border';
                optionDiv.innerHTML = `
                    <input type="text" value="${option.name}" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg" onchange="updateAdditionalOption(${index}, 'name', this.value)">
                    <div class="flex items-center space-x-2">
                        <span>$</span>
                        <input type="number" value="${option.price}" step="0.01" min="0" class="w-20 px-3 py-2 border border-gray-300 rounded-lg" onchange="updateAdditionalOption(${index}, 'price', parseFloat(this.value))">
                    </div>
                    <button onclick="removeAdditionalOption(${index})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg transition-colors">
                        üóëÔ∏è
                    </button>
                `;
                container.appendChild(optionDiv);
            });
        }
        
        function updateGiftOption(index, field, value) {
            giftOptions[index][field] = value;
        }
        
        function updateAdditionalOption(index, field, value) {
            additionalOptions[index][field] = value;
        }
        
        function addGiftOption() {
            const newOption = {
                id: 'gift-option-' + Date.now(),
                name: 'Nueva opci√≥n de regalo',
                price: 0.00
            };
            giftOptions.push(newOption);
            loadGiftOptionsEditor();
        }
        
        function addAdditionalOption() {
            const newOption = {
                id: 'additional-option-' + Date.now(),
                name: 'Nueva opci√≥n adicional',
                price: 0.00
            };
            additionalOptions.push(newOption);
            loadAdditionalOptionsEditor();
        }
        
        function removeGiftOption(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta opci√≥n?')) {
                giftOptions.splice(index, 1);
                loadGiftOptionsEditor();
            }
        }
        
        function removeAdditionalOption(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta opci√≥n?')) {
                additionalOptions.splice(index, 1);
                loadAdditionalOptionsEditor();
            }
        }
        
        function saveExtrasChanges() {
            updateProductModalOptions();
            alert('üíæ ¬°Cambios en extras guardados exitosamente!');
        }
        
        function updateProductModalOptions() {
            // Update gift options in product modal
            const giftContainer = document.getElementById('gift-options-list');
            if (giftContainer) {
                giftContainer.innerHTML = '';
                
                giftOptions.forEach(option => {
                    const label = document.createElement('label');
                    label.className = 'flex items-center';
                    label.innerHTML = `
                        <input type="checkbox" id="${option.id}" class="mr-3" onchange="updatePrice()">
                        <span>${option.name} (+$${option.price.toFixed(2)})</span>
                    `;
                    giftContainer.appendChild(label);
                });
            }
            
            // Update additional options in product modal
            const additionalContainer = document.getElementById('additional-options-list');
            if (additionalContainer) {
                additionalContainer.innerHTML = '';
                
                additionalOptions.forEach(option => {
                    const label = document.createElement('label');
                    label.className = 'flex items-center';
                    label.innerHTML = `
                        <input type="checkbox" id="${option.id}" class="mr-3" onchange="updatePrice()">
                        <span>${option.name} (+$${option.price.toFixed(2)})</span>
                    `;
                    additionalContainer.appendChild(label);
                });
            }
        }

        // Update price calculation to use dynamic options
        function updatePrice() {
            let total = currentProduct.basePrice;
            const quantity = parseInt(document.getElementById('quantity').textContent);

            // Calculate gift options
            giftOptions.forEach(option => {
                const checkbox = document.getElementById(option.id);
                if (checkbox && checkbox.checked) {
                    total += option.price;
                }
            });

            // Calculate additional options
            additionalOptions.forEach(option => {
                const checkbox = document.getElementById(option.id);
                if (checkbox && checkbox.checked) {
                    total += option.price;
                }
            });

            total *= quantity;
            document.getElementById('modal-price').textContent = `$${total.toFixed(2)}`;
        }

        function loadBoxCustomization() {
            if (!currentProduct.isBox) return;
            
            if (currentProduct.boxType === 'cuchareables') {
                loadCucharablesCustomization();
            } else if (currentProduct.boxType === 'brownies') {
                loadBrowniesCustomization();
            }
            
            // Update box summary
            document.getElementById('box-total-count').textContent = `0 de ${currentProduct.boxSize}`;
        }

        function loadCucharablesCustomization() {
            document.getElementById('cuchareables-customization').classList.remove('hidden');
            document.getElementById('brownies-customization').classList.add('hidden');
            
            const flavorsList = document.getElementById('box-flavors-list');
            flavorsList.innerHTML = '';
            
            const availableFlavors = products['cuchareables'].filter(product => product.stock === 'in-stock');
            
            if (availableFlavors.length === 0) {
                flavorsList.innerHTML = '<p class="text-gray-500 text-center py-4">No hay sabores disponibles en este momento</p>';
                return;
            }
            
            availableFlavors.forEach(flavor => {
                const flavorDiv = document.createElement('div');
                flavorDiv.className = 'flex items-center justify-between p-3 bg-white rounded-lg border';
                flavorDiv.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl">${flavor.emoji}</span>
                        <div>
                            <h4 class="font-medium">${flavor.name}</h4>
                            <p class="text-sm text-gray-600">${flavor.description}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="changeFlavor('${flavor.id}', -1)" class="bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center text-sm">-</button>
                        <input type="number" id="flavor-${flavor.id}" class="flavor-quantity w-16 text-center border border-gray-300 rounded px-2 py-1" value="0" min="0" max="${currentProduct.boxSize}" onchange="updateBoxSummary()">
                        <button onclick="changeFlavor('${flavor.id}', 1)" class="bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center text-sm">+</button>
                    </div>
                `;
                flavorsList.appendChild(flavorDiv);
            });
        }

        function loadBrowniesCustomization() {
            document.getElementById('brownies-customization').classList.remove('hidden');
            document.getElementById('cuchareables-customization').classList.add('hidden');
            
            // Update instructions based on box size
            const instructions = document.getElementById('brownies-instructions');
            const creamyLimit = document.getElementById('creamy-limit');
            const regularLimit = document.getElementById('regular-limit');
            
            if (currentProduct.boxSize === 4) {
                instructions.textContent = 'Selecciona 2 Creamy Toppings y 2 Regular Toppings para tu caja de 4 brownies.';
                creamyLimit.textContent = 'Selecciona exactamente 2 opciones';
                regularLimit.textContent = 'Selecciona exactamente 2 opciones';
            } else if (currentProduct.boxSize === 6) {
                instructions.textContent = 'Selecciona 2 Creamy Toppings y 4 Regular Toppings para tu caja de 6 brownies.';
                creamyLimit.textContent = 'Selecciona exactamente 2 opciones';
                regularLimit.textContent = 'Selecciona exactamente 4 opciones';
            }
            
            loadToppingsSection('creamy');
            loadToppingsSection('regular');
        }

        function loadToppingsSection(type) {
            const container = document.getElementById(`${type}-toppings-list`);
            container.innerHTML = '';
            
            brownieToppings[type].forEach(topping => {
                const toppingDiv = document.createElement('div');
                toppingDiv.className = `flex items-center justify-between p-3 rounded-lg border ${topping.available ? 'bg-white' : 'bg-gray-100 opacity-50'}`;
                
                toppingDiv.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl">${topping.emoji}</span>
                        <div>
                            <h4 class="font-medium ${topping.available ? 'text-gray-900' : 'text-gray-500'}">${topping.name}</h4>
                            <p class="text-sm ${topping.available ? 'text-green-600' : 'text-red-500'}">
                                ${topping.available ? '‚úÖ Disponible' : '‚ùå No disponible'}
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" 
                               id="topping-${type}-${topping.id}" 
                               class="topping-checkbox ${type}-topping w-5 h-5 text-amber-600 rounded focus:ring-amber-500" 
                               ${topping.available ? '' : 'disabled'} 
                               onchange="updateToppingsSelection('${type}')">
                    </div>
                `;
                container.appendChild(toppingDiv);
            });
        }

        function updateToppingsSelection(type) {
            const checkboxes = document.querySelectorAll(`.${type}-topping:checked`);
            const maxAllowed = getMaxToppings(type);
            
            if (checkboxes.length > maxAllowed) {
                // Uncheck the last selected checkbox
                const lastChecked = checkboxes[checkboxes.length - 1];
                lastChecked.checked = false;
                
                const typeName = type === 'creamy' ? 'Creamy' : 'Regular';
                alert(`Solo puedes seleccionar ${maxAllowed} ${typeName} Toppings.`);
            }
            
            updateBrownieBoxSummary();
        }

        function getMaxToppings(type) {
            if (currentProduct.boxSize === 4) {
                return 2; // Both creamy and regular get 2 for box of 4
            } else if (currentProduct.boxSize === 6) {
                return type === 'creamy' ? 2 : 4; // Creamy gets 2, regular gets 4 for box of 6
            }
            return 0;
        }

        function updateBrownieBoxSummary() {
            const creamySelected = document.querySelectorAll('.creamy-topping:checked').length;
            const regularSelected = document.querySelectorAll('.regular-topping:checked').length;
            const totalSelected = creamySelected + regularSelected;
            
            const boxTotalCount = document.getElementById('box-total-count');
            boxTotalCount.textContent = `${totalSelected} de ${currentProduct.boxSize} (${creamySelected} Creamy + ${regularSelected} Regular)`;
            
            // Change color based on completion
            const maxCreamy = getMaxToppings('creamy');
            const maxRegular = getMaxToppings('regular');
            
            if (creamySelected === maxCreamy && regularSelected === maxRegular) {
                boxTotalCount.className = 'font-bold text-green-600';
            } else {
                boxTotalCount.className = 'font-bold text-pink-600';
            }
        }

        function changeFlavor(flavorId, change) {
            const input = document.getElementById(`flavor-${flavorId}`);
            let currentValue = parseInt(input.value) || 0;
            let newValue = currentValue + change;
            
            // Get current total selected
            const currentTotal = getCurrentBoxTotal();
            
            // Check if we can add more
            if (change > 0 && currentTotal >= currentProduct.boxSize) {
                alert(`Ya has seleccionado ${currentProduct.boxSize} productos para tu caja.`);
                return;
            }
            
            if (newValue < 0) newValue = 0;
            if (newValue > currentProduct.boxSize) newValue = currentProduct.boxSize;
            
            input.value = newValue;
            updateBoxSummary();
        }

        function getCurrentBoxTotal() {
            let total = 0;
            document.querySelectorAll('.flavor-quantity').forEach(input => {
                total += parseInt(input.value) || 0;
            });
            return total;
        }

        function updateBoxSummary() {
            const total = getCurrentBoxTotal();
            const boxTotalCount = document.getElementById('box-total-count');
            boxTotalCount.textContent = `${total} de ${currentProduct.boxSize}`;
            
            // Change color based on completion
            if (total === currentProduct.boxSize) {
                boxTotalCount.className = 'font-bold text-green-600';
            } else if (total > currentProduct.boxSize) {
                boxTotalCount.className = 'font-bold text-red-600';
            } else {
                boxTotalCount.className = 'font-bold text-pink-600';
            }
        }

        // Update getSelectedOptions to use dynamic options
        function getSelectedOptions() {
            const options = [];
            
            giftOptions.forEach(option => {
                const checkbox = document.getElementById(option.id);
                if (checkbox && checkbox.checked) {
                    options.push(option.name);
                }
            });
            
            additionalOptions.forEach(option => {
                const checkbox = document.getElementById(option.id);
                if (checkbox && checkbox.checked) {
                    options.push(option.name);
                }
            });
            
            return options;
        }

        // Update showAdminTab function to handle extras tab
        function showAdminTab(tab) {
            // Hide all content
            document.querySelectorAll('.admin-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.admin-tab, .admin-tab-active').forEach(tabBtn => {
                tabBtn.className = 'admin-tab py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            });
            
            // Show selected content and activate tab
            document.getElementById(`${tab}-content`).classList.remove('hidden');
            document.getElementById(`${tab}-tab`).className = 'admin-tab-active py-2 px-1 border-b-2 border-pink-500 font-medium text-sm text-pink-600';
            
            if (tab === 'products') {
                showCategoryProducts('mas-vendidos');
            } else if (tab === 'orders') {
                displayOrders();
                updateOrdersSummary();
            } else if (tab === 'categories') {
                loadCategoriesEditor();
            } else if (tab === 'extras') {
                // Initialize extras tab with all components
                setTimeout(() => {
                    loadToppingsEditor();
                    loadGiftOptionsEditor();
                    loadAdditionalOptionsEditor();
                    
                    // Load current delivery settings
                    if (deliverySettings.nextDeliveryDate) {
                        const deliveryInput = document.getElementById('admin-next-delivery');
                        if (deliveryInput) {
                            deliveryInput.value = deliverySettings.nextDeliveryDate;
                        }
                    }
                    const intervalInput = document.getElementById('delivery-interval');
                    if (intervalInput) {
                        intervalInput.value = deliverySettings.intervalDays;
                    }
                }, 100);
            } else if (tab === 'coupons') {
                loadCouponsManager();
            } else if (tab === 'settings') {
                loadStoreSettings();
            }
        }

        // Coupon management functions
        function loadCouponsManager() {
            displayCoupons();
            
            // Add form event listener
            document.getElementById('add-coupon-form').addEventListener('submit', function(e) {
                e.preventDefault();
                createCoupon();
            });
        }
        
        function createCoupon() {
            const code = document.getElementById('new-coupon-code').value.trim().toUpperCase();
            const type = document.getElementById('new-coupon-type').value;
            const value = parseFloat(document.getElementById('new-coupon-value').value);
            const minimum = parseFloat(document.getElementById('new-coupon-minimum').value) || 0;
            const expiry = document.getElementById('new-coupon-expiry').value;
            const limit = parseInt(document.getElementById('new-coupon-limit').value) || null;
            const description = document.getElementById('new-coupon-description').value.trim();
            
            // Validate
            if (!code || !type || !value) {
                alert('Por favor completa todos los campos obligatorios.');
                return;
            }
            
            // Check if code already exists
            if (coupons.find(c => c.code === code)) {
                alert('Ya existe un cup√≥n con este c√≥digo.');
                return;
            }
            
            // Create coupon
            const newCoupon = {
                id: 'coupon-' + Date.now(),
                code: code,
                type: type,
                value: value,
                minimumPurchase: minimum,
                expiryDate: expiry || null,
                usageLimit: limit,
                usedCount: 0,
                description: description,
                active: true,
                createdDate: new Date().toISOString()
            };
            
            coupons.push(newCoupon);
            displayCoupons();
            
            // Reset form
            document.getElementById('add-coupon-form').reset();
            
            alert(`üé´ Cup√≥n "${code}" creado exitosamente!`);
        }
        
        function displayCoupons() {
            const activeCoupons = coupons.filter(c => c.active && (!c.expiryDate || new Date(c.expiryDate) >= new Date()));
            const inactiveCoupons = coupons.filter(c => !c.active || (c.expiryDate && new Date(c.expiryDate) < new Date()));
            
            // Update counts
            document.getElementById('active-coupons-count').textContent = activeCoupons.length;
            document.getElementById('inactive-coupons-count').textContent = inactiveCoupons.length;
            
            // Display active coupons
            const activeList = document.getElementById('active-coupons-list');
            if (activeCoupons.length === 0) {
                activeList.innerHTML = '<p class="text-gray-500 text-center py-8">No hay cupones activos</p>';
            } else {
                activeList.innerHTML = activeCoupons.map(coupon => createCouponCard(coupon, true)).join('');
            }
            
            // Display inactive coupons
            const inactiveList = document.getElementById('inactive-coupons-list');
            if (inactiveCoupons.length === 0) {
                inactiveList.innerHTML = '<p class="text-gray-500 text-center py-8">No hay cupones inactivos</p>';
            } else {
                inactiveList.innerHTML = inactiveCoupons.map(coupon => createCouponCard(coupon, false)).join('');
            }
        }
        
        function createCouponCard(coupon, isActive) {
            const discountText = coupon.type === 'percentage' ? `${coupon.value}%` : `$${coupon.value.toFixed(2)}`;
            const expiryText = coupon.expiryDate ? new Date(coupon.expiryDate).toLocaleDateString('es-ES') : 'Sin expiraci√≥n';
            const usageText = coupon.usageLimit ? `${coupon.usedCount}/${coupon.usageLimit} usos` : `${coupon.usedCount} usos`;
            
            return `
                <div class="border rounded-lg p-4 ${isActive ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="text-lg font-bold ${isActive ? 'text-green-800' : 'text-gray-600'}">${coupon.code}</h4>
                            <p class="text-sm ${isActive ? 'text-green-600' : 'text-gray-500'}">${coupon.description || 'Sin descripci√≥n'}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-bold ${isActive ? 'text-green-600' : 'text-gray-500'}">${discountText} OFF</div>
                            <div class="text-xs ${isActive ? 'text-green-500' : 'text-gray-400'}">${coupon.type === 'percentage' ? 'Porcentaje' : 'Monto fijo'}</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                        <div>
                            <span class="font-medium">Compra m√≠nima:</span>
                            <span class="${isActive ? 'text-green-700' : 'text-gray-600'}">$${coupon.minimumPurchase.toFixed(2)}</span>
                        </div>
                        <div>
                            <span class="font-medium">Expira:</span>
                            <span class="${isActive ? 'text-green-700' : 'text-gray-600'}">${expiryText}</span>
                        </div>
                        <div>
                            <span class="font-medium">Usos:</span>
                            <span class="${isActive ? 'text-green-700' : 'text-gray-600'}">${usageText}</span>
                        </div>
                        <div>
                            <span class="font-medium">Estado:</span>
                            <span class="${isActive ? 'text-green-600 font-medium' : 'text-red-600 font-medium'}">${isActive ? '‚úÖ Activo' : '‚ùå Inactivo'}</span>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        ${isActive ? `
                            <button onclick="toggleCouponStatus('${coupon.id}')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                ‚è∏Ô∏è Desactivar
                            </button>
                        ` : `
                            <button onclick="toggleCouponStatus('${coupon.id}')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                ‚ñ∂Ô∏è Activar
                            </button>
                        `}
                        <button onclick="editCoupon('${coupon.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            ‚úèÔ∏è Editar
                        </button>
                        <button onclick="deleteCoupon('${coupon.id}')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            üóëÔ∏è Eliminar
                        </button>
                        <button onclick="copyCouponCode('${coupon.code}')" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            üìã Copiar
                        </button>
                    </div>
                </div>
            `;
        }
        
        function toggleCouponStatus(couponId) {
            const coupon = coupons.find(c => c.id === couponId);
            if (coupon) {
                coupon.active = !coupon.active;
                displayCoupons();
                alert(`üé´ Cup√≥n "${coupon.code}" ${coupon.active ? 'activado' : 'desactivado'} exitosamente.`);
            }
        }
        
        function editCoupon(couponId) {
            const coupon = coupons.find(c => c.id === couponId);
            if (!coupon) return;
            
            // Fill form with current coupon data
            document.getElementById('new-coupon-code').value = coupon.code;
            document.getElementById('new-coupon-type').value = coupon.type;
            document.getElementById('new-coupon-value').value = coupon.value;
            document.getElementById('new-coupon-minimum').value = coupon.minimumPurchase;
            document.getElementById('new-coupon-expiry').value = coupon.expiryDate || '';
            document.getElementById('new-coupon-limit').value = coupon.usageLimit || '';
            document.getElementById('new-coupon-description').value = coupon.description || '';
            
            // Change form to edit mode
            const form = document.getElementById('add-coupon-form');
            form.dataset.editId = couponId;
            form.querySelector('button[type="submit"]').textContent = 'üíæ Guardar Cambios';
            
            // Scroll to form
            form.scrollIntoView({ behavior: 'smooth' });
        }
        
        function deleteCoupon(couponId) {
            const coupon = coupons.find(c => c.id === couponId);
            if (coupon && confirm(`¬øEst√°s seguro de que quieres eliminar el cup√≥n "${coupon.code}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
                coupons = coupons.filter(c => c.id !== couponId);
                displayCoupons();
                alert(`üóëÔ∏è Cup√≥n "${coupon.code}" eliminado exitosamente.`);
            }
        }
        
        function copyCouponCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                alert(`üìã C√≥digo "${code}" copiado al portapapeles.`);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert(`üìã C√≥digo "${code}" copiado al portapapeles.`);
            });
        }

        // Reviews functionality
        let currentRating = 0;
        
        function setRating(rating) {
            currentRating = rating;
            const stars = document.querySelectorAll('#star-rating .star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('text-gray-300');
                    star.classList.add('text-yellow-400');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-300');
                }
            });
        }
        
        function submitReview(event) {
            event.preventDefault();
            
            const name = document.getElementById('review-name').value;
            const reviewText = document.getElementById('review-text').value;
            
            if (!name || !reviewText || currentRating === 0) {
                alert('Por favor completa todos los campos y selecciona una calificaci√≥n.');
                return;
            }
            
            alert(`¬°Gracias ${name}! Tu rese√±a de ${currentRating} estrellas ha sido enviada y ser√° revisada antes de publicarse.`);
            
            // Reset form
            document.getElementById('review-name').value = '';
            document.getElementById('review-text').value = '';
            setRating(0);
        }

        // Initialize sample coupons
        function initializeSampleCoupons() {
            coupons.push(
                {
                    id: 'coupon-welcome',
                    code: 'BIENVENIDO10',
                    type: 'percentage',
                    value: 10,
                    minimumPurchase: 15,
                    expiryDate: null,
                    usageLimit: null,
                    usedCount: 0,
                    description: 'Descuento del 10% para nuevos clientes',
                    active: true,
                    createdDate: new Date().toISOString()
                },
                {
                    id: 'coupon-birthday',
                    code: 'CUMPLE5',
                    type: 'fixed',
                    value: 5,
                    minimumPurchase: 25,
                    expiryDate: null,
                    usageLimit: 50,
                    usedCount: 12,
                    description: '$5 de descuento en tortas de cumplea√±os',
                    active: true,
                    createdDate: new Date().toISOString()
                }
            );
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeProducts();
            initializeSampleCoupons();
            updateCartDisplay();
            updateStoreBranding();
            updateContactInfo();
            updateHeroSection();
            updateNextDeliveryDisplay();
            updateDeliveryOptions();
            
            // Initialize product modal options
            setTimeout(() => {
                updateProductModalOptions();
            }, 100);
            
            // Add event listener for delivery date changes
            document.getElementById('delivery-date').addEventListener('change', updateDeliveryMessage);
            
            // Add event listeners for delivery method changes
            document.querySelectorAll('input[name="delivery-method"]').forEach(radio => {
                radio.addEventListener('change', updateCartDisplay);
            });
        });
    </script>

    <!-- Floating WhatsApp Button -->
    <div class="fixed bottom-6 right-6 z-50">
        <a href="https://wa.me/50761336689?text=¬°Hola! Me interesa conocer m√°s sobre sus productos de reposter√≠a. ¬øPodr√≠an ayudarme?" 
           target="_blank" 
           class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center group">
            <span class="text-2xl">üí¨</span>
            <span class="ml-2 hidden group-hover:inline-block text-sm font-medium whitespace-nowrap">WhatsApp</span>
        </a>
    </div>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'95e5361b12fd7442',t:'MTc1MjM3MjI4NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
